---
description: 既存のドキュメントをL1形式に変換する
argument-hint: <ファイルパス> - 変換元のドキュメントパス（必須）
allowed-tools: Read, Write, Edit
---

# L1 変換コマンド

## 引数

- `$1`: 変換元のドキュメントパス（必須）

## エラー処理

### 引数がない場合

```
エラー: 変換元のファイルパスを指定してください。
使用方法: /convert-l1 <ファイルパス>
例: /convert-l1 docs/existing-spec.md
```

### 変換元ファイルが存在しない場合

```
エラー: 指定されたファイルが見つかりません: [ファイルパス]
ファイルパスを確認してください。
```

### テンプレートが存在しない場合

```
エラー: L1 テンプレートが見つかりません。
必要なファイル: docs/templates/l1_vision.md
先に /init-ssdd を実行するか、テンプレートを配置してください。
```

### 出力先に既存ファイルがある場合

`docs/l1_vision.md` が既に存在する場合、ユーザーに確認：

```
警告: docs/l1_vision.md は既に存在します。
以下から選択してください:
1. 上書き（既存内容は失われます）
2. 別名で保存（vision_converted.md）
3. マージ（既存内容と統合）
4. キャンセル
```

## 前提処理

1. `.claude/skills/ssdd.md` を読み込み、SSDD の基本概念を把握する
2. `docs/templates/l1_vision.md` を読み込み、L1 テンプレートを確認する
3. `docs/templates/README.md` を読み込み、フロントマター仕様を確認する
4. `$1` で指定されたファイルを読み込む

## ID採番ロジック

### REQ ID採番アルゴリズム

```markdown
# REQ ID採番アルゴリズム

1. 現在日時を取得: YYYYMMDD = "20250125"
2. 既存のREQ IDを検索:
   - Grepで docs/**/*.md から `REQ-{YYYYMMDD}-` で始まるIDを抽出
3. 同日のREQ IDがある場合:
   - 最大連番を取得: max_num = 002
   - 次の連番を計算: next_num = 003
   - 新ID: REQ-20250125-003
4. 同日のREQ IDがない場合:
   - 新ID: REQ-20250125-001

例:
- 2025年1月25日の最初のREQ: REQ-20250125-001
- 2025年1月25日の2番目のREQ: REQ-20250125-002
- 2025年1月26日の最初のREQ: REQ-20250126-001
```

**重要**:
- タイムスタンプベースのIDにより、並行開発時のID衝突を防止
- 変換時に抽出した要件から順次採番する

## 実行内容

既存のドキュメントを分析し、L1 形式に変換します。

## 変換手順

### Step 1: 元ドキュメント分析

- ドキュメントの構造を把握
- 要件に該当する記述を抽出
- 技術的な詳細（L2相当）と要件（L1相当）を分離

### Step 2: 情報マッピング

元ドキュメントの内容を L1 テンプレートの各セクションにマッピング：

| L1 セクション | 抽出対象 |
|--------------|---------|
| プロダクトの目的・背景 | 概要、背景、目的の記述 |
| 制約条件・前提 | 動作環境、前提条件の記述 |
| 機能要求 | 機能一覧、ユースケースの記述 |
| 非機能要求 | 性能、セキュリティ等の記述 |

### Step 3: REQ ID 付与

- 抽出した要件に REQ-YYYYMMDD-nnn 形式で ID を付与
- 採番は上記「ID採番ロジック」に従う

### Step 4: 不足情報の特定

L1 テンプレートで必要だが元ドキュメントにない情報を特定し、
`<!-- TODO: 要確認 -->` でマーク

## 出力仕様

- **ファイルパス**: `docs/l1_vision.md`
- **フロントマター**: `doc_status: draft` で開始
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク

## 出力例

```yaml
---
id: VISION-0001
kind: vision
layer: L1
status: active
doc_status: draft
---

# [プロダクト名] ビジョン・要求ドキュメント
```

**注**: v2.0以降、`title`フィールドは廃止。本文の`# 見出し`がタイトルとして扱われます。

## 完了後の案内

- 変換結果のサマリを報告
- 元ドキュメントから抽出できなかった情報を一覧表示
- `/gen-l2` で L2 を生成できることを案内
