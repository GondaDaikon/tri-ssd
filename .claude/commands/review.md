---
description: SSDDドキュメントのAIレビューを実行する
argument-hint: <ファイルパス|ID> - レビュー対象（必須）
allowed-tools: Read, Glob, Grep
---

# AI レビューコマンド

## 引数

- `$1`: レビュー対象（必須）
  - ファイルパス: 直接ファイルを指定
  - ID: REQ-YYYYMMDD-nnn, F-YYYYMMDD-nnn, PH-YYYYMMDD-nnn 等の ID で指定

## エラー処理

### 引数がない場合

```
エラー: レビュー対象を指定してください。
使用方法: /review <ファイルパス|ID>
例:
  /review docs/l1_vision.md
  /review F-20250125-001
  /review REQ-20250125-001
```

### 指定されたファイルが存在しない場合

```
エラー: 指定されたファイルが見つかりません: [ファイルパス]
ファイルパスを確認してください。
```

### 指定された ID が見つからない場合

```
エラー: 指定された ID のドキュメントが見つかりません: [ID]
docs/ 配下を検索しましたが、該当するドキュメントがありません。

ヒント:
- /check --list-ids で存在する ID 一覧を確認できます
- ID の形式を確認してください（例: F-20250125-001, REQ-20250125-001, PH-20250125-001）
```

### テンプレートが存在しない場合

```
警告: テンプレートが見つからないため、構造レビューをスキップします。
必要なファイル: docs/templates/[該当テンプレート].md
```

## 前提処理

1. `.claude/skills/ssdd.md` を読み込み、SSDD の基本概念を把握する
2. `docs/templates/README.md` を読み込み、フロントマター仕様を確認する
3. 対象のレイヤに応じたテンプレートを読み込む:
   - L1: `docs/templates/l1_vision.md`
   - L2: `docs/templates/l2_overview.md`, `docs/templates/l2_phases.md`
   - L3: `docs/templates/l3_feature.md`
4. `$1` で指定された対象ファイルを特定・読み込む

## ID からファイル特定

`$1` が ID 形式の場合：

1. `docs/` 配下の全 `.md` ファイルを検索
2. フロントマターの `id` フィールドが一致するファイルを特定
3. 見つからない場合はエラー

## レビュー観点

### 1. フロントマター検証

- 必須フィールドの存在と妥当性
- 参照フィールドの整合性
- **v2.0対応**: タイトル見出しの存在確認
  - フロントマター直後に `# 見出し` が存在するか
  - `title` フィールドが残存していないか（v2.0では廃止）

### 2. 構造レビュー

- テンプレートに沿った構成になっているか
- 必須セクションが存在するか
- 各セクションの内容が適切か

### 3. 内容レビュー（レイヤ別）

#### L1 レビュー観点

- [ ] 技術詳細が混入していないか（L2相当の内容）
- [ ] 要件が REQ-YYYYMMDD-nnn 形式で ID 管理されているか
- [ ] ペルソナ・ユースケースが具体的か
- [ ] 非機能要求が高レベルで記載されているか
- [ ] **v2.0**: タイトル見出しが存在し、title フィールドが残存していないか

#### L2 レビュー観点

- [ ] L1 の REQ が漏れなくカバーされているか
- [ ] 機能分解の粒度が適切か
- [ ] フェーズ設計が「結合して意味がある」単位か
- [ ] 技術選定の理由が明記されているか
- [ ] 依存関係が明確か

#### L3 レビュー観点

- [ ] L2 の機能定義と整合しているか
- [ ] 受け入れ条件が具体的か（Given-When-Then）
- [ ] タスクチェックリストが実装可能な粒度か
- [ ] 非機能要求の具体化が十分か

### 3.5 定量的レビュー基準（v2.2追加）

#### L1 ビジョン・要求

| 項目 | 基準 | 判定 |
|------|------|------|
| REQ数 | 5-50個 | 5個未満: 粒度が粗い / 50個超: L2に寄せすぎ |
| REQ記述量 | 1REQ = 50-300文字 | 50文字未満: 不明瞭 / 300文字超: 詳細すぎ |
| 技術用語 | 5%以下 | 技術詳細（API名等）はL2へ |
| NFR数 | 3-15個 | 3個未満: 不足 / 15個超: 詳細すぎ |
| TODO残存 | 0個（reviewed時） | draft時は許容、reviewed時は0 |

#### L2 機能設計・技術方針

| 項目 | 基準 | 判定 |
|------|------|------|
| フェーズ数 | 2-8個 | 1個: 分割不足 / 8個超: 過度な分割 |
| 機能数（F） | 10-100個 | 10個未満: 粒度が粗い / 100個超: 細かすぎ |
| NF数 | 5-20個 | 5個未満: 不足 / 20個超: 詳細すぎ |
| REQカバレッジ | 100% | すべてのREQがF/NFに紐付いているか |
| 孤立F | 0個 | どのPHにも属さないFがないか |
| 循環依存 | 0個 | F間の依存関係に循環がないか |

#### L3 機能ドキュメント

| 項目 | 基準 | 判定 |
|------|------|------|
| 受け入れ条件数 | 2-10個 | 2個未満: 不足 / 10個超: 詳細すぎ |
| タスク数 | 3-20個 | 3個未満: 粒度が粗い / 20個超: 細かすぎ |
| TODO残存 | 0個（reviewed時） | draft時は許容、reviewed時は0 |
| プレースホルダー | 0個（reviewed時） | `[xxx]`形式の残存チェック |
| req_ids | 1個以上 | どのREQにも紐付かないFはNG |
| phase | 必須 | 未指定はNG |

### 4. TODO チェック

- `<!-- TODO: 要確認 -->` の残存箇所を指摘

### 5. 上位層との整合性

- L3 の場合: L2 の定義との整合性
- L2 の場合: L1 の要求との整合性

## 出力形式

```
## レビュー結果: [ファイル名]

### サマリ
- レイヤ: [L1|L2|L3]
- ID: [ID]
- doc_status: [status]

### 指摘事項

#### 重要（修正推奨）
1. [指摘内容]
   - 該当箇所: [セクション名/行番号]
   - 修正案: [具体的な修正案]

#### 軽微（検討推奨）
1. [指摘内容]
   - 該当箇所: [セクション名/行番号]
   - 提案: [改善提案]

### TODO 残存
- [行番号]: [TODO内容]

### 良い点
- [評価ポイント]

### 総評
[全体的な評価とネクストアクションの提案]
```

## 完了後の案内

- 指摘事項がある場合: 修正の優先順位を提案
- `doc_status: draft` の場合: `reviewed` への変更条件を説明
- 整合性問題がある場合: `/check` での確認を推奨
