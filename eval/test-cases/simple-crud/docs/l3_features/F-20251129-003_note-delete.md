---
id: F-20251129-003
kind: feature
layer: L3
req_ids:
  - REQ-20251129-003
nfr_ids:
  - NF-20251129-001
  - NF-20251129-002
phase: PH-20251129-001
doc_status: draft
---

# メモ削除

## 1. 概要

### 1.1 機能説明

不要になったメモを削除する機能。ユーザーがメモ一覧から削除したいメモを選択し、削除ボタンをクリックすることで、該当メモを永久に削除する。

### 1.2 ユースケース

**主アクター**: 個人ユーザー

**前提条件**:
- メモが1件以上存在する
- ユーザーがメモ一覧画面を開いている

**基本フロー**:
1. ユーザーが削除したいメモの削除ボタンをクリック
2. システムがメモを削除
3. システムがメモ一覧を更新して表示

**代替フロー**:
- 3a. メモが見つからない場合
  - システムがエラーメッセージを表示

---

## 2. データモデル

### 2.1 関連エンティティ

この機能は既存の `Note` エンティティを削除する。新規エンティティの定義は不要。

**参照**: Note エンティティの定義は foundation.md に記載されている想定。

---

## 3. インターフェース

### 3.1 UI構成

```
┌─────────────────────────────────────────┐
│ SimpleNote                               │
├─────────────────────────────────────────┤
│ メモ一覧                                  │
│                                          │
│ ┌────────────────────────────────────┐  │
│ │ タイトル: 買い物リスト              │  │
│ │ 本文: 牛乳、卵...                   │  │
│ │                      [削除] ←ここ   │  │
│ └────────────────────────────────────┘  │
│                                          │
│ ┌────────────────────────────────────┐  │
│ │ タイトル: TODO                      │  │
│ │ 本文: プロジェクト...               │  │
│ │                      [削除]         │  │
│ └────────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

**UI要素**:
- 削除ボタン: 各メモカードに配置
- エラーメッセージ表示エリア（削除失敗時）

### 3.2 API仕様

#### DELETE /api/notes/:id

**リクエスト**:
```
DELETE /api/notes/123
```

**レスポンス（成功）**:
```json
{
  "success": true
}
```
HTTP Status: 204 No Content

**レスポンス（失敗 - メモが見つからない）**:
```json
{
  "error": {
    "code": "NOTE_NOT_FOUND",
    "message": "指定されたメモが見つかりません"
  }
}
```
HTTP Status: 404 Not Found

**レスポンス（失敗 - サーバーエラー）**:
```json
{
  "error": {
    "code": "NOTE_DELETE_FAILED",
    "message": "メモの削除に失敗しました"
  }
}
```
HTTP Status: 500 Internal Server Error

### 3.3 処理シーケンス

```
ユーザー       UI          API         DB
  |            |           |           |
  |--クリック-->|           |           |
  |            |--DELETE-->|           |
  |            |           |--削除---->|
  |            |           |<--OK------|
  |            |<--204-----|           |
  |<--更新-----|           |           |
```

---

## 4. 業務ルール・例外

### 4.1 バリデーションルール

| 項目 | ルール | エラーコード | エラーメッセージ |
|------|--------|-------------|-----------------|
| Note ID | 必須 | VALIDATION_REQUIRED | メモIDが指定されていません |
| Note ID | 数値 | VALIDATION_INVALID_TYPE | メモIDは数値である必要があります |
| Note 存在 | DB に存在する | NOTE_NOT_FOUND | 指定されたメモが見つかりません |

### 4.2 例外ケース

| ケース | 動作 | エラーコード |
|--------|------|-------------|
| メモが存在しない | 404エラーを返す | NOTE_NOT_FOUND |
| DB接続エラー | 500エラーを返す | NOTE_DELETE_FAILED |
| 不正なID形式 | 400エラーを返す | VALIDATION_INVALID_TYPE |

---

## 5. 非機能要求

### 5.1 NFR具体化

| NFR ID | 本機能での適用 |
|--------|---------------|
| NF-20251129-001 | DELETE API応答を500ms以内に完了 |
| NF-20251129-002 | HTTPS通信でリクエストを送信 |

### 5.2 受け入れ条件

#### AC1: 正常な削除
```gherkin
Given メモ一覧に「買い物リスト」というメモが存在する
When ユーザーが「買い物リスト」の削除ボタンをクリックする
Then メモが削除される
And メモ一覧から「買い物リスト」が消える
```

#### AC2: 存在しないメモの削除
```gherkin
Given 削除対象のメモが既に削除されている
When ユーザーが削除ボタンをクリックする
Then エラーメッセージ「指定されたメモが見つかりません」が表示される
And メモ一覧の表示は変わらない
```

#### AC3: 削除失敗時のエラーハンドリング
```gherkin
Given メモ一覧に「TODO」というメモが存在する
When サーバーがエラーを返す状態でユーザーが削除ボタンをクリックする
Then エラーメッセージ「メモの削除に失敗しました」が表示される
And メモ一覧に「TODO」が残る
```

---

## 6. タスクチェックリスト

### 6.1 実装タスク

- [ ] DELETE /api/notes/:id エンドポイント実装
  - [ ] バリデーション実装（ID必須、数値型チェック）
  - [ ] Prisma delete クエリ実装
  - [ ] エラーハンドリング実装
- [ ] フロントエンド削除ボタンコンポーネント実装
  - [ ] 削除ボタンUI作成
  - [ ] DELETE API呼び出し実装
  - [ ] 削除後のリスト再取得実装
  - [ ] エラー表示実装

### 6.2 テストタスク

- [ ] API単体テスト
  - [ ] 正常系: メモが削除される
  - [ ] 異常系: 存在しないIDで404
  - [ ] 異常系: 不正なID形式で400
- [ ] フロントエンド単体テスト
  - [ ] 削除ボタンクリックでAPIが呼ばれる
  - [ ] 削除成功後にリストが更新される
  - [ ] エラー時にメッセージが表示される
- [ ] E2Eテスト
  - [ ] メモ作成→削除→一覧から消える一連の流れ

---

## 7. 実装メモ・注意点

### 7.1 設計パターン

特になし（シンプルなCRUD操作）

### 7.2 関連コードへのリンク

<!-- 実装後に記載 -->

### 7.3 技術的負債・暫定対応

<!-- 実装中に問題が発見された場合に記載 -->
