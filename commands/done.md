---
description: Tri-SSDドキュメントを完了（done）にマークする
argument-hint: <ファイルパス|ID> - 完了対象（必須）
allowed-tools: Read, Edit, Glob, Grep
---

# Tri-SSD 完了マーキングコマンド

<tri_ssd_context>
Tri-SSD（Tri-Layer Slice Spec Driven）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L0: アイディア・ラフメモ（docs/l0_ideas/）- 任意
- L1: 要件（docs/l1_requirements/vision.md）
- L2: システム構成（docs/l2_foundation/foundation.md）
- L3: フェーズ（docs/l3_phases/PH-xxx.md）- 機能+受け入れ条件

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F）
</tri_ssd_context>

## 完了マーキング時の原則

<avoid_over_engineering>
- 重箱の隅をつつかない（本質的な問題に集中）
- 「あった方がよい」程度の改善は指摘しない
- ドキュメントの複雑さが機能の複雑さに見合っているか確認
- 単純な機能に対して「セクションが足りない」と指摘しない
</avoid_over_engineering>

## 引数

- `$1` (必須): 完了対象
  - **ファイルパス**: 直接指定
  - **ID**: REQ-xxx, PH-xxx, F-xxx 等で指定

### 使用例

```
/done docs/l1_requirements/vision.md      # L1を完了
/done PH-20250203-001                      # フェーズを完了
/done F-20250203-001                       # 機能を完了
```

## 前提処理

1. `$1` で指定された対象ファイルを特定・読み込む

## 確認項目

<thinking_process>
完了マーキング前に、以下を判断する：

1. **このドキュメントの目的は何か？**（L1/L2/L3 で求められるものが異なる）
2. **機能の複雑さに対して適切な詳細度か？**
3. **致命的な問題 vs あれば良い改善 を区別する**
</thinking_process>

### 共通
- [ ] フロントマター `status: wip` が存在するか
- [ ] タイトル見出しが存在するか
- [ ] TODO/プレースホルダーの残存確認

### L1（要件）
- [ ] プロダクト目的が明確か
- [ ] ペルソナが具体的か
- [ ] 機能要求に優先度があるか

### L2（システム構成）
- [ ] 技術選定の根拠があるか
- [ ] アーキテクチャが定義されているか

### L3（フェーズ）
- [ ] 目的が明確か
- [ ] 受け入れ条件がテスト可能か
- [ ] Exit Criteriaが明確か

## 出力形式

```markdown
# 完了マーキング確認

**ファイル**: docs/l3_phases/PH-20250125-001_mvp.md
**現在のステータス**: wip

## 確認結果

### 良い点
- ...

### 問題点（あれば）
1. [重要] ...
2. [軽微] ...

## 判定

**完了可能**: Yes / No（問題がある場合は理由）
```

## 完了フロー

1. 確認結果を出力
2. 完了可能な場合：「完了にしますか？ (yes/no)」と確認
3. yes の場合：`status: wip` → `status: done` に更新

### 更新例

```yaml
# 変更前
---
status: wip
---

# 変更後
---
status: done
---
```

## L3 特有の確認

L3フェーズを完了にする場合は、追加で以下を確認：

### 受け入れ条件のチェック状況
- 全ての受け入れ条件が `[x]` になっているか
- なっていない場合は警告を表示（ブロックはしない）

### Exit Criteria のチェック状況
- 全ての Exit Criteria が `[x]` になっているか
- なっていない場合は警告を表示（ブロックはしない）

## 完了後の案内

- 更新内容を報告
- 次のステップを案内
  - L1完了 → `/gen-l2` でL2生成
  - L2完了 → `/gen-l3` でL3生成
  - L3完了 → `/gen-code` でコード生成、または次のフェーズへ

---

## エラーケース

| ケース | 対応 |
|--------|------|
| ファイルが存在しない | エラー: 「指定されたファイルが見つかりません」 |
| 既に done 状態 | 警告: 「既に完了済みです」 |
| フロントマターがない | エラー: 「フロントマターが見つかりません」 |
| ID に該当するファイルが複数 | エラー: 「複数のファイルが見つかりました。パスを直接指定してください」 |
