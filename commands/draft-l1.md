---
description: L1（ビジョン・要求）ドキュメントを作成する
argument-hint: "[ファイルパス] - 変換元ドキュメント（省略時は対話モード）"
allowed-tools: Read, Write, Edit, Glob, Grep
---

# L1 作成コマンド

<tri_ssd_context>
Tri-SSD（Tri-Layer Slice Spec Driven）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L1: ビジョン・要求（docs/l1_vision.md）
- L2: 技術基盤（docs/l2_system/）- foundation.md, phases.md, rules.md
- L3: 機能仕様（docs/l3_features/F-xxx.md）

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F, NF）
ステータス: draft → reviewed → implemented（L3のみ）
</tri_ssd_context>

## 引数

- `$1`: 変換元ドキュメントパス（省略可）
  - **指定あり** → 変換モード（既存ドキュメントをL1形式に変換）
  - **省略** → 対話モード（ヒアリングでL1を作成）

## 原則

<avoid_over_engineering>
- 必要以上に詳細を聞き出さない（技術詳細はL2で決める）
- 「わからない」→ TODOマークして先に進む
- 機能要求は概要レベルで十分（詳細はL3）
- 元ドキュメントにない情報を推測・捏造しない
</avoid_over_engineering>

## 前提処理

1. `templates/l1_vision.md` を読み込み、テンプレート確認
2. `$1` があれば変換元ファイルを読み込む
3. `docs/l1_vision.md` が存在するか確認（再生成モード判定）

---

## 変換モード（$1 指定時）

### 変換手順

1. **元ドキュメント分析**: 構造把握、要件抽出、技術詳細とL1相当を分離
2. **情報マッピング**:
   | L1 セクション | 抽出対象 |
   |--------------|---------|
   | プロダクトの目的 | 概要、背景、目的 |
   | 制約条件 | 動作環境、前提条件 |
   | 機能要求 | 機能一覧、ユースケース |
   | 非機能要求 | 性能、セキュリティ等 |
3. **REQ ID付与**: タイムスタンプベース
4. **不足情報**: `<!-- TODO: 要確認 -->` でマーク

### 既存L1がある場合

- **上書き**: 既存を破棄して新規作成
- **マージ**: 既存と変換元を統合（REQ ID継続）
- **キャンセル**: 変換を中止

---

## 対話モード（$1 省略時）

### 対話フロー

**Step 1: プロダクト概要**
1. プロダクト名は？
2. 解決したい課題は？
3. 想定ユーザー（ペルソナ）は？

**Step 2: 制約条件**
1. 動作環境（OS、ブラウザ等）は？
2. 法規制やコンプライアンス要件は？
3. 連携が必要な外部システムは？

**Step 3: 機能要求**
1. 主な機能を教えてください
2. 各機能の優先度（高/中/低）は？
3. 参考にしたい類似サービスは？

**Step 4: 非機能要求**
1. 性能要求は？（レスポンス時間等）
2. セキュリティ要件は？
3. その他の品質要求は？

---

## 再生成モード（既存L1がある場合・対話モード時）

1. 既存ファイル読み込み、内容把握
2. ユーザーに確認：
   - **追記**: 新しい要件を追加（REQ ID継続）
   - **修正**: 既存要件を変更（影響範囲を報告）
   - **深掘り**: TODO箇所を詳細化
   - **最初から**: 既存を破棄して新規作成

### 保持するもの

| セクション | 理由 |
|-----------|------|
| 既存のREQ ID | トレーサビリティ維持 |
| doc_statusがreviewed以上 | 承認済みを保護 |
| 更新履歴 | 変更経緯を保持 |

---

## 出力仕様

- **ファイルパス**: `docs/l1_vision.md`
- **フロントマター**: `doc_status: draft`
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク
- **REQ ID**: タイムスタンプベース（REQ-YYYYMMDD-nnn）

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存REQ IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成

## 完了後の案内

- 作成ファイルのパスを報告
- 変換モード時: 抽出できなかった情報を一覧表示
- `/draft-l2` で L2 生成できることを案内
