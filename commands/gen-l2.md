---
description: L2 システム構成（foundation.md）を生成する
argument-hint: なし
allowed-tools: Read, Write, Edit, Glob, Grep, WebSearch
---

# L2 生成コマンド

<tri_ssd_context>
Tri-SSD（Tri-Layer Slice Spec Driven）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L0: アイディア・ラフメモ（docs/l0_ideas/）- 任意
- L1: 要件（docs/l1_requirements/vision.md）
- L2: システム構成（docs/l2_foundation/foundation.md）
- L3: フェーズ（docs/l3_phases/PH-xxx.md）- 機能+受け入れ条件

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F）
</tri_ssd_context>

## 概要

L1（要件）から L2 システム構成（foundation.md）を生成する。
技術選定はユーザーとの対話を通じて行う。

## 生成時の原則

<avoid_over_engineering>
- 直接要求されたか、明確に必要な技術選定のみ行う
- シンプルな技術スタックを優先する（複雑な構成は避ける）
- 要件の規模に見合った技術を選定する（個人プロジェクトにエンタープライズ構成は不要）
- 「将来必要になるかも」で技術を追加しない
</avoid_over_engineering>

## 引数

- 引数なし（L1から対話的に技術選定を行う）

### 使用例

```
/gen-l2
```

## 前提処理

1. `docs/l1_requirements/vision.md` を読み込み、要件を把握する
2. `docs/l2_foundation/foundation.md` が存在するか確認（再生成モード判定）

---

## 出力フォーマット（必須）

### YAMLフロントマター

```yaml
---
status: wip
---
```

### 必須構造

```markdown
# [プロダクト名] システム構成

## 1. 技術スタック
### 1.1 フロントエンド
### 1.2 バックエンド
### 1.3 データベース
### 1.4 インフラ
（各カテゴリで選定理由を記載）

### 1.5 開発環境（省略可）
- OS: macOS / Windows / Linux
- バージョン管理: Volta / nvm / asdf / pyenv / mise
- ランタイム: Node.js 20.x / Python 3.12 / Go 1.22
- パッケージマネージャ: npm / pnpm / yarn / uv / poetry
- コンテナ: Docker Desktop / Podman / なし

### 1.6 実行環境（省略可）
- ターゲットOS: Linux (Ubuntu 22.04) / iOS 17+ / Android 14+
- デバイス: サーバー / Raspberry Pi / モバイル端末
- ランタイム: Node.js 18.x (LTS)
- 開発環境との差異: （あれば記載）

## 2. アーキテクチャ
### 2.1 コンポーネント構成図（ASCII図）
### 2.2 ディレクトリ構成

## 3. 非機能要求（省略可）
- 性能: レスポンス時間、スループット
- セキュリティ: 認証・認可方式
- 可用性: SLA、冗長構成
- スケーラビリティ: 想定負荷、スケール方式
- 運用・保守性: 監視、ログ、バックアップ
- 移行性: データ移行、既存システムからの移行方式

## 4. 用語集（省略可）
| 用語 | 定義 |
|------|------|
```

**必須**: セクション 1（該当するカテゴリのみ）, 2
**省略可能**: セクション 1.5, 1.6, 3, 4
<!-- 例: CLIツールならフロントエンド/DB不要、ライブラリならインフラ不要 -->

## 再生成モード（既存ファイルがある場合）

既存の `foundation.md` がある場合は**再生成モード**で動作する。

### 保持するもの（上書きしない）

| セクション | 理由 |
|-----------|------|
| 採用しなかった選択肢 | 過去の検討結果は資産 |
| ユーザーが追記したメモ | 手動編集を尊重 |

### 更新するもの

| セクション | 条件 |
|-----------|------|
| 技術スタック | L1変更または明示的な変更要求時 |
| アーキテクチャ | 技術スタック変更に伴う場合 |

### 再生成時の手順

1. 既存ファイルを読み込み、各セクションの内容を把握
2. L1との差分を分析
3. ユーザーに「何を更新するか」を確認
4. 保持セクションはそのまま、更新セクションのみ再生成

## 生成手順

### Step 1: L1分析

- 要件を把握
- 用語の抽出
- 非機能要件の抽出

### Step 2: 技術選定（対話型）

WebSearchで**該当するカテゴリのみ**候補を検索:
- フロントエンド（Web/モバイルUIがある場合）
- バックエンド（サーバー処理がある場合）
- データベース（永続化が必要な場合）
- 認証方式（ユーザー認証がある場合）
- インフラ/デプロイ先

<!-- 以下に該当する場合のみ確認 -->
**開発・実行環境（該当時のみ）**:
- チーム開発でツール統一が必要
- 開発マシンと実行環境が異なる（Mac開発→Linux本番、PC→Raspberry Pi等）

<thinking_process>
技術選定の判断時は、以下の形式で思考を整理してから結論を出す：

1. **要件の確認**: L1で求められている規模・性能・セキュリティレベル
2. **候補の評価**: 各候補の長所・短所をL1要件に照らして評価
3. **チーム適合性**: ユーザーの技術スタック経験を考慮
4. **判断**: 最もシンプルかつ要件を満たす選択肢を推奨
</thinking_process>

ユーザーに選択肢を提示し、対話を通じて選択してもらう。

### Step 3: アーキテクチャ設計

以下を定義:
- コンポーネント構成図（ASCII図）
- ディレクトリ構成（プロジェクト構造）

### Step 4: 非機能要求整理（該当時のみ）

L1の非機能要求を具体化（該当するもののみ）:
- 性能（レスポンス時間、スループット）
- セキュリティ（認証・認可方式）
- 可用性（SLA、冗長構成）
- スケーラビリティ（想定負荷、スケール方式）
- 運用・保守性（監視、ログ、バックアップ）
- 移行性（既存システムからの移行方式）

## 出力ファイル

| ファイル |
|---------|
| `docs/l2_foundation/foundation.md` |

## 完了後の案内

- 生成ファイルのパスを報告
- **`/gen-l3`** でL3フェーズを生成することを案内
- `/status` で進捗確認を案内

---

## エラーケース

| ケース | 対応 |
|--------|------|
| L1が存在しない | エラー: 「L1が見つかりません。`/gen-l1` を先に実行してください」 |
| L1が wip 状態 | 警告: 「L1が未完了です。続行しますか？」 |
