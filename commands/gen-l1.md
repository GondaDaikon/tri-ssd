---
description: L1（要件）ドキュメントを生成する
argument-hint: "[ファイルパス] - 変換元ドキュメント（省略時は対話モード）"
allowed-tools: Read, Write, Edit, Glob, Grep
---

# L1 生成コマンド

<tri_ssd_context>
Tri-SSD（Tri-Layer Slice Spec Driven）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L0: アイディア・ラフメモ（docs/l0_ideas/）- 任意
- L1: 要件（docs/l1_requirements/vision.md）
- L2: システム構成（docs/l2_foundation/foundation.md）
- L3: フェーズ（docs/l3_phases/PH-xxx.md）- 機能+受け入れ条件

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F）
</tri_ssd_context>

## 引数

- `$1` (省略可): 変換元ドキュメントパス
  - **指定あり** → 変換モード（既存ドキュメントをL1形式に変換）
  - **省略** → 対話モード（ヒアリングでL1を作成）

### 使用例

```
/gen-l1                           # 対話モード
/gen-l1 docs/existing-spec.md     # 既存ドキュメントを変換
/gen-l1 README.md                 # READMEから要件を抽出
```

## 原則

<avoid_over_engineering>
- 必要以上に詳細を聞き出さない（技術詳細はL2で決める）
- 「わからない」→ TODOマークして先に進む
- 機能要求は概要レベルで十分（詳細はL3フェーズ）
- 元ドキュメントにない情報を推測・捏造しない
</avoid_over_engineering>

## 前提処理

1. `$1` があれば変換元ファイルを読み込む
2. `docs/l0_ideas/` にファイルがあれば参考にする
3. `docs/l1_requirements/vision.md` が存在するか確認（再生成モード判定）

---

## 出力フォーマット（必須）

### YAMLフロントマター

```yaml
---
status: wip
---
```

**重要**: フロントマターは必ず上記形式で出力する。`---` で囲み、インデントなし。

### 必須構造

```markdown
# [プロダクト名] ビジョン・要求ドキュメント

## 1. プロダクトの目的・背景
### 1.1 解決したい課題・ペイン
### 1.2 想定ユーザー／ペルソナ
### 1.3 ビジネス上のゴール
### 1.4 スコープ外（やらないこと）

## 2. 制約条件・前提（省略可）
### 2.1 動作環境（Web / モバイル / デスクトップ / 組み込み 等）
### 2.2 予算・リソース制約
### 2.3 法規制・コンプライアンス
### 2.4 組織ポリシー（承認済みツール、セキュリティ方針等）
### 2.5 外部システム連携

## 3. 機能要求一覧
### [要求名]
- **ID**: REQ-YYYYMMDD-nnn
- **優先度**: 高/中/低
[概要説明]

## 4. 非機能要求（高レベル・省略可）

## 5. 参考・類似サービス（省略可）
```

**省略可能**: セクション2, 4, 5（該当しなければ削除）
**必須**: セクション1, 3（最低限これだけあればL2生成可能）

---

## 変換モード（$1 指定時）

### 変換手順

1. **元ドキュメント分析**: 構造把握、要件抽出、技術詳細とL1相当を分離
2. **情報マッピング**:
   | L1 セクション | 抽出対象 |
   |--------------|---------|
   | プロダクトの目的 | 概要、背景、目的 |
   | 制約条件 | 動作環境、予算、規制、組織ポリシー、外部連携 |
   | 機能要求 | 機能一覧、ユースケース |
   | 非機能要求 | 性能、セキュリティ等 |
3. **REQ ID付与**: タイムスタンプベース
4. **不足情報**: `<!-- TODO: 要確認 -->` でマーク

### 既存L1がある場合

- **上書き**: 既存を破棄して新規作成
- **マージ**: 既存と変換元を統合（REQ ID継続）
- **キャンセル**: 変換を中止

---

## 対話モード（$1 省略時）

### 対話フロー

各ステップで**3択+任意**の質問を提示し、回答を深掘りする。
新しい情報が出なくなったら次のステップへ進む。

**Step 1: プロダクト概要**

まずプロダクト名を聞き、以下を3択+任意で確認:

Q1: 動作環境は？（複数可）
1. Web
2. モバイル（iOS/Android）
3. デスクトップ
4. その他:

Q2: 想定ユーザーは？（複数可）
1. 個人（エンドユーザー）
2. 企業・組織（B2B）
3. 開発者
4. その他:

Q3: 解決したい課題は？（複数可）
1. 業務効率化・自動化
2. 情報管理・共有
3. コミュニケーション
4. その他:

→ 回答を受けて深掘り（3択+任意で追加質問）
→ 新しい情報が出なくなったら Step 2 へ

**Step 2: 機能要求**

Q1: 必要な機能は？（複数可）
1. ユーザー認証・管理
2. データの作成・編集・削除
3. 検索・フィルタリング
4. その他:

Q2: 優先度が高いのは？（複数可）
1. 最初に作るべき機能
2. あると便利な機能
3. 将来的に欲しい機能
4. その他:

Q3: 参考にしたいサービスは？（複数可）
1. 既存の類似サービス名
2. 社内の既存システム
3. 特になし
4. その他:

→ 回答を受けて深掘り
→ 新しい情報が出なくなったら Step 3 へ

**Step 3: 制約・非機能**

Q1: 技術的な制約は？（複数可）
1. 外部API連携あり
2. 既存DB・システム連携あり
3. 特定の技術スタック指定あり
4. その他:

Q2: 非機能要件は？（複数可）
1. 高い可用性（24/365稼働等）
2. 高いセキュリティ（個人情報、決済等）
3. 大量アクセス対応
4. その他:

<!-- 業務/チーム開発の場合のみ -->
Q3: 組織的な制約は？（複数可）
1. 予算制限あり
2. 承認済みツール制限あり
3. 法規制・コンプライアンス対応
4. その他:

→ 回答を受けて深掘り
→ 新しい情報が出なくなったら完了

---

## 再生成モード（既存L1がある場合・対話モード時）

1. 既存ファイル読み込み、内容把握
2. ユーザーに確認：
   - **追記**: 新しい要件を追加（REQ ID継続）
   - **修正**: 既存要件を変更（影響範囲を報告）
   - **深掘り**: TODO箇所を詳細化
   - **最初から**: 既存を破棄して新規作成

### 保持するもの

| セクション | 理由 |
|-----------|------|
| 既存のREQ ID | トレーサビリティ維持 |
| status: done のファイル | 完了済みを保護 |

---

## 出力仕様

- **ファイルパス**: `docs/l1_requirements/vision.md`
- **フロントマター**: `status: wip`
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク
- **REQ ID**: タイムスタンプベース（REQ-YYYYMMDD-nnn）

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存REQ IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成

## 完了後の案内

- 作成ファイルのパスを報告
- 変換モード時: 抽出できなかった情報を一覧表示
- `/gen-l2` で L2 生成できることを案内

---

## エラーケース

| ケース | 対応 |
|--------|------|
| 変換元ファイルが存在しない | エラー: 「指定されたファイルが見つかりません」 |
| 変換元が空ファイル | エラー: 「ファイルが空です」 |
| docs/ が存在しない | 警告: 「`/init-tri-ssd` を先に実行することを推奨します」 |
