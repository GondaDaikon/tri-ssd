---
description: L1（要件）ドキュメントを生成する
argument-hint: "[ファイルパス] - 変換元ドキュメント（省略時は対話モード）"
allowed-tools: Read, Write, Edit, Glob, Grep
---

# L1 生成コマンド

<tri_ssd_context>
Tri-SSD（Tri-Layer Slice Spec Driven）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L0: アイディア・ラフメモ（docs/l0_ideas/）- 任意
- L1: 要件（docs/l1_requirements/vision.md）
- L2: システム構成（docs/l2_foundation/foundation.md）
- L3: フェーズ（docs/l3_phases/PH-xxx.md）- 機能+受け入れ条件

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F）
</tri_ssd_context>

## 引数

- `$1` (省略可): 変換元ドキュメントパス
  - **指定あり** → 変換モード（既存ドキュメントをL1形式に変換）
  - **省略** → 対話モード（ヒアリングでL1を作成）

### 使用例

```
/gen-l1                           # 対話モード
/gen-l1 docs/existing-spec.md     # 既存ドキュメントを変換
/gen-l1 README.md                 # READMEから要件を抽出
```

## 原則

<avoid_over_engineering>
- 必要以上に詳細を聞き出さない（技術詳細はL2で決める）
- 「わからない」→ TODOマークして先に進む
- 機能要求は概要レベルで十分（詳細はL3フェーズ）
- 元ドキュメントにない情報を推測・捏造しない
</avoid_over_engineering>

## 前提処理

1. `$1` があれば変換元ファイルを読み込む
2. `docs/l0_ideas/` にファイルがあれば参考にする
3. `docs/l1_requirements/vision.md` が存在するか確認（再生成モード判定）

---

## 出力フォーマット（必須）

### YAMLフロントマター

```yaml
---
status: wip
---
```

**重要**: フロントマターは必ず上記形式で出力する。`---` で囲み、インデントなし。

### 必須構造

```markdown
# [プロダクト名] ビジョン・要求ドキュメント

## 1. プロダクトの目的・背景
### 1.1 解決したい課題・ペイン
### 1.2 想定ユーザー／ペルソナ
### 1.3 ビジネス上のゴール

## 2. 制約条件・前提（省略可）
### 2.1 動作環境（Web / モバイル / デスクトップ / 組み込み 等）
### 2.2 予算・リソース制約
### 2.3 法規制・コンプライアンス
### 2.4 組織ポリシー（承認済みツール、セキュリティ方針等）
### 2.5 外部システム連携

## 3. 機能要求一覧
### [要求名]
- **ID**: REQ-YYYYMMDD-nnn
- **優先度**: 高/中/低
[概要説明]

## 4. 非機能要求（高レベル・省略可）

## 5. 参考・類似サービス（省略可）
```

**省略可能**: セクション2, 4, 5（該当しなければ削除）
**必須**: セクション1, 3（最低限これだけあればL2生成可能）

---

## 変換モード（$1 指定時）

### 変換手順

1. **元ドキュメント分析**: 構造把握、要件抽出、技術詳細とL1相当を分離
2. **情報マッピング**:
   | L1 セクション | 抽出対象 |
   |--------------|---------|
   | プロダクトの目的 | 概要、背景、目的 |
   | 制約条件 | 動作環境、予算、規制、組織ポリシー、外部連携 |
   | 機能要求 | 機能一覧、ユースケース |
   | 非機能要求 | 性能、セキュリティ等 |
3. **REQ ID付与**: タイムスタンプベース
4. **不足情報**: `<!-- TODO: 要確認 -->` でマーク

### 既存L1がある場合

- **上書き**: 既存を破棄して新規作成
- **マージ**: 既存と変換元を統合（REQ ID継続）
- **キャンセル**: 変換を中止

---

## 対話モード（$1 省略時）

### 対話フロー

**Step 1: プロダクト概要**
1. プロダクト名は？
2. 解決したい課題は？
3. 想定ユーザー（ペルソナ）は？

**Step 2: 機能要求**
1. 主な機能を教えてください
2. 各機能の優先度（高/中/低）は？
3. 参考にしたい類似サービスは？

**Step 3: 制約・非機能（簡潔に・該当があれば）**
1. 動作環境（Web/モバイル/デスクトップ等）は？
2. 外部システム連携は？（API、DB、認証基盤等）
3. 特別なセキュリティ・性能要件は？
<!-- 業務/チーム開発の場合のみ -->
4. 予算・リソース制約は？
5. 組織ポリシーや規制要件は？

---

## 再生成モード（既存L1がある場合・対話モード時）

1. 既存ファイル読み込み、内容把握
2. ユーザーに確認：
   - **追記**: 新しい要件を追加（REQ ID継続）
   - **修正**: 既存要件を変更（影響範囲を報告）
   - **深掘り**: TODO箇所を詳細化
   - **最初から**: 既存を破棄して新規作成

### 保持するもの

| セクション | 理由 |
|-----------|------|
| 既存のREQ ID | トレーサビリティ維持 |
| status: done のファイル | 完了済みを保護 |

---

## 出力仕様

- **ファイルパス**: `docs/l1_requirements/vision.md`
- **フロントマター**: `status: wip`
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク
- **REQ ID**: タイムスタンプベース（REQ-YYYYMMDD-nnn）

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存REQ IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成

## 完了後の案内

- 作成ファイルのパスを報告
- 変換モード時: 抽出できなかった情報を一覧表示
- `/gen-l2` で L2 生成できることを案内

---

## エラーケース

| ケース | 対応 |
|--------|------|
| 変換元ファイルが存在しない | エラー: 「指定されたファイルが見つかりません」 |
| 変換元が空ファイル | エラー: 「ファイルが空です」 |
| docs/ が存在しない | 警告: 「`/init-tri-ssd` を先に実行することを推奨します」 |
