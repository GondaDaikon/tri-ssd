---
description: L2からL3（機能ドキュメント）を生成する
argument-hint: "[F-xxxx ...] - 対象の機能ID（省略時は全体）"
allowed-tools: Read, Write, Edit, Glob, Grep
---

# L3 生成コマンド

## 引数

- `$ARGUMENTS`: 対象の機能ID（省略可、複数指定可）
  - 指定時: 指定された F-xxxx のみを対象
  - 省略時: L2 の機能一覧全体を対象

## 前提処理

1. `skills/ssdd/SKILL.md` を読み込み、SSDD の基本概念を把握する
2. `skills/ssdd/examples.md` を読み込み、L3の実例を確認する
3. `skills/ssdd/templates/l3_feature.md` を読み込み、L3テンプレートを確認する
4. `docs/l2_system/foundation.md` を読み込み、技術方針・NFRカタログを把握する
5. `docs/l2_system/phases.md` を読み込み、フェーズ定義・機能一覧を把握する
6. `docs/l2_system/rules.md` を読み込み、**実装ルール（コード生成制約）を把握する**（存在する場合）

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存F IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成

## 生成手順

### Step 1: 対象機能の特定
- 引数があれば指定されたF-xxxx
- なければ phases.md の全機能

### Step 2: 既存L3の確認
- `docs/l3_features/` に既存があれば確認

### Step 3: 技術基盤との整合性確認

**foundation.md から確認**:
- 使用する技術スタック
- 適用するアーキテクチャパターン
- セキュリティ方針（認証・認可の適用）
- エラーハンドリング方針（エラーコード体系）

**rules.md から確認**（存在する場合）:
- 適用すべき実装ルール
- 禁止事項

### Step 4: データモデル定義

以下を定義:
- **エンティティ**: この機能で扱うデータエンティティ
- **データ構造**: 型定義（TypeScript interface等）
- **状態遷移**: 状態を持つ場合は状態遷移図とテーブル

**注**: 状態遷移は複雑な機能（ワークフロー、注文処理等）でのみ必要

### Step 5: インターフェース設計

機能の種類に応じて適切なセクションを選択:

| 機能種別 | 記載するセクション |
|----------|-------------------|
| 画面機能 | 画面構成（ASCII図） |
| API | エンドポイント、リクエスト/レスポンス |
| CLI | コマンド形式、オプション、終了コード |
| バッチ | 入出力ファイル、実行スケジュール |

**シーケンス図**: 複数コンポーネントが連携する場合に記載

### Step 6: 業務ルール・例外定義

- **バリデーションルール**: 各入力項目のルールとエラーメッセージ
- **権限・ロール**: ロール別の許可操作と制限
- **例外ケース**: 異常系の動作と**エラーコード**（foundation.mdの体系に従う）

### Step 7: 非機能・受け入れ条件

- **NFR具体化**: foundation.mdのNFRをこの機能でどう満たすか
- **受け入れ条件**: Gherkin形式（Given-When-Then）で3つ以上

### Step 8: タスクチェックリスト

- **実装タスク**: コンポーネント作成、API実装、バリデーション等
- **テストタスク**: ユニット、結合、E2E

### Step 9: 実装メモ（初期は空または最小限）

- 適用する設計パターン（該当があれば）
- 関連コードへのリンク（実装後に埋める）
- 技術的負債・暫定対応（該当があれば）

## 出力ファイル

- パターン: `docs/l3_features/F-YYYYMMDD-nnn_[機能名].md`
- 例: `F-20250125-001_user-registration.md`

## 出力仕様

- **フロントマター**: `doc_status: draft`
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク
- **参照フィールド**: `req_ids`, `nfr_ids`, `phase` を正確に記載

## 生成時の注意

- **データモデルは必須セクションではない**: 単純なCRUDや表示機能では省略可
- **状態遷移は複雑な機能のみ**: 無理に埋めない
- **CLI/バッチセクション**: 該当しない場合は削除してよい
- **エラーコードはfoundation.mdの体系に従う**: 勝手に新体系を作らない

## 完了後の案内

- 生成ファイルのパスを報告
- TODO箇所の数を報告
- 「foundation.md/rules.md との整合性を確認してください」と案内
- `/check` で整合性チェックを案内
- `/review F-xxxx` でレビューを案内
