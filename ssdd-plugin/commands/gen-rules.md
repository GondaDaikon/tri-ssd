---
description: L2実装ルールのたたき台を生成する
argument-hint: "[--minimal] - オプション: --minimal（最小限の骨格のみ生成）"
allowed-tools: Read, Write, Edit, Glob, Grep, WebSearch
---

# 実装ルール生成コマンド

## 概要

L2 foundation.mdの技術スタックとL1のドメインルールを基に、実装ルールの**たたき台**を生成する。

> **重要**: このコマンドで生成されるのは初期版であり、L3実装を通じて継続的に更新・進化させることを前提とする。

## 引数

- `--minimal`: 最小限の骨格のみ生成（セクション見出しと空欄）

## 前提条件

- `/gen-l2` が完了していること（`docs/l2_system/foundation.md` が存在）
- `docs/l1_vision.md` が存在すること

## 前提処理

1. `skills/ssdd/SKILL.md` を読み込み、SSDD の基本概念を把握する
2. `skills/ssdd/templates/l2_rules.md` を読み込み、テンプレート構造を確認
3. `docs/l2_system/foundation.md` を読み込み、技術スタックを把握
4. `docs/l1_vision.md` を読み込み、ドメインルール・制約を把握

## 生成手順

### Step 1: 技術スタック抽出

L2 foundation.mdから以下を抽出:
- 使用言語・バージョン
- フレームワーク
- ORM/DB
- 状態管理ライブラリ
- テストツール

### Step 2: L1からドメインルール抽出

L1から以下を抽出:
- 「制約条件」セクションの内容
- 「〜してはいけない」「〜は必ず〜」などの記述
- ビジネス上の絶対ルール

### Step 3: ベストプラクティス検索（WebSearch）

各技術について検索:
- `[技術名] best practices [年]`
- `[技術名] common mistakes`
- `[技術名] anti-patterns`

抽出する情報:
- 禁止事項（やってはいけないこと）
- 必須事項（必ずやるべきこと）
- 推奨事項（やった方がよいこと）

### Step 4: ルール生成

テンプレートに沿って以下を生成:

| セクション | 生成方法 |
|-----------|---------|
| 1. コード規約 | Step 3の検索結果から |
| 2. アーキテクチャ | L2 foundationから + 検索結果 |
| 3. ドメインルール | Step 2のL1抽出から |
| 4. API・データアクセス | Step 3の検索結果から |
| 5. セキュリティ・ログ | Step 3の検索結果から |
| 6. テスト | L2 foundation + 検索結果から |
| 7. AI固有の禁止事項 | テンプレート固定 |

### Step 5: 対話による確認

以下をユーザーに確認:
- 命名規則の好み
- ディレクトリ構成の既存ルール
- プロジェクト固有の制約

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存RULES IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成
4. 形式: `RULES-YYYYMMDD-nnn`

## 出力ファイル

| モード | ファイル |
|--------|---------|
| 通常 | `docs/l2_system/rules.md` |
| --minimal | `docs/l2_system/rules.md`（骨格のみ） |

## 完了後の案内

- 生成ファイルのパスを報告
- 「これは**たたき台**です。L3実装を通じて継続的に更新してください」と案内
- `/gen-l3` で L3 生成できることを案内
- ルール追加の判断基準を説明

## 注意事項

- 検索結果は参考情報であり、プロジェクトに適さないルールは削除してよい
- 最初から完璧を目指さない（L3実装で育てる）
- 不明な部分は空欄のまま生成し、後で埋める
