---
description: L2実装ルールのたたき台を生成する
argument-hint: "[--minimal] - オプション: --minimal（最小限の骨格のみ生成）"
allowed-tools: Read, Write, Edit, Glob, Grep, WebSearch
---

# 実装ルール生成コマンド

## 概要

L2 foundation.mdの技術スタックとL1のドメインルールを基に、実装ルールの**たたき台**を生成する。

> **重要**: このコマンドで生成されるのは初期版であり、L3実装を通じて継続的に更新・進化させることを前提とする。

## 引数

- `--minimal`: 最小限の骨格のみ生成（セクション見出しと空欄）

## 前提条件

- `/gen-l2` が完了していること（`docs/l2_system/foundation.md` が存在）
- `docs/l1_vision.md` が存在すること

## 前提処理

1. `skills/ssdd/SKILL.md` を読み込み、SSDD の基本概念を把握する
2. `skills/ssdd/templates/l2_rules.md` を読み込み、テンプレート構造を確認
3. `docs/l2_system/foundation.md` を読み込み、以下を把握:
   - 技術スタック
   - **セキュリティ方針**（認証・認可、データ保護）
   - **エラーハンドリング方針**（エラー分類、コード体系）
   - **ログ・監視方針**（ログレベル、出力ガイドライン）
4. `docs/l1_vision.md` を読み込み、ドメインルール・制約を把握

## 生成手順

### Step 1: 技術スタック抽出

L2 foundation.mdから以下を抽出:
- 使用言語・バージョン
- フレームワーク
- ORM/DB
- 状態管理ライブラリ
- テストツール

### Step 2: L1からドメインルール抽出

L1から以下を抽出:
- 「制約条件」セクションの内容
- 「〜してはいけない」「〜は必ず〜」などの記述
- ビジネス上の絶対ルール

### Step 3: foundation.mdの方針をルール化

foundation.mdから以下を実装ルールに変換:

| foundation.mdセクション | 生成するルール |
|------------------------|---------------|
| セキュリティ方針 | 認証・認可の実装ルール、データ保護ルール |
| エラーハンドリング方針 | エラーコード使用ルール、エラーレスポンス形式 |
| ログ・監視方針 | ログ出力ルール（何をどのレベルで） |
| 開発環境要件 | 環境固有の制約（使用禁止ライブラリ等） |

### Step 4: ベストプラクティス検索（WebSearch）

各技術について検索:
- `[技術名] best practices [年]`
- `[技術名] common mistakes`
- `[技術名] anti-patterns`

抽出する情報:
- 禁止事項（やってはいけないこと）
- 必須事項（必ずやるべきこと）
- 推奨事項（やった方がよいこと）

### Step 5: ルール生成

テンプレートに沿って以下を生成:

| セクション | 生成方法 |
|-----------|---------|
| 1. コード規約 | 技術スタック + 検索結果から |
| 2. アーキテクチャ | L2 foundation（レイヤ構造）から |
| 3. ドメインルール | L1抽出から |
| 4. API・データアクセス | エラーハンドリング方針 + 検索結果から |
| 5. セキュリティ・ログ | セキュリティ方針 + ログ方針から |
| 6. テスト | L2 foundation + 検索結果から |
| 7. AI固有の禁止事項 | テンプレート固定 |

### Step 6: 対話による確認

以下をユーザーに確認:
- 命名規則の好み（既存プロジェクトがある場合）
- ディレクトリ構成の既存ルール
- プロジェクト固有の制約

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存RULES IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成
4. 形式: `RULES-YYYYMMDD-nnn`

## 出力ファイル

| モード | ファイル |
|--------|---------|
| 通常 | `docs/l2_system/rules.md` |
| --minimal | `docs/l2_system/rules.md`（骨格のみ） |

## 生成時の注意

- **foundation.mdとの整合性**: セキュリティ方針・エラーコード体系はfoundation.mdと矛盾しないこと
- **具体的に書く**: 「適切に〜」ではなく、具体的なルールを書く
- **理由を明記**: なぜそのルールが必要か、更新履歴に理由を残す

## 完了後の案内

- 生成ファイルのパスを報告
- 「これは**たたき台**です。L3実装を通じて継続的に更新してください」と案内
- 「foundation.mdのセキュリティ方針・エラー方針と整合性を確認してください」と案内
- `/gen-l3` で L3 生成できることを案内
- ルール追加の判断基準を説明

## 注意事項

- 検索結果は参考情報であり、プロジェクトに適さないルールは削除してよい
- 最初から完璧を目指さない（L3実装で育てる）
- 不明な部分は空欄のまま生成し、後で埋める
- **エラーコード体系はfoundation.mdで定義済み**なので、rules.mdでは「その体系に従う」と記載する
