---
description: 対話形式でL1（ビジョン・要求）ドキュメントを作成する
argument-hint: なし
allowed-tools: Read, Write, Edit, Glob, Grep
---

# L1 ドラフト作成コマンド

<ssdd_context>
SSDD（Slices Specification-Driven Development）はAI/LLMコードエージェントを前提とした仕様駆動開発。

レイヤー構造:
- L1: ビジョン・要求（docs/l1_vision.md）
- L2: 技術基盤（docs/l2_system/）- foundation.md, phases.md, rules.md
- L3: 機能仕様（docs/l3_features/F-xxx.md）

ID形式: PREFIX-YYYYMMDD-nnn（REQ, PH, F, NF）
ステータス: draft → reviewed → implemented（L3のみ）
</ssdd_context>

## 対話時の原則

<avoid_over_engineering>
- 必要以上に詳細を聞き出さない（L2で決める技術詳細はL1に書かない）
- ユーザーが「わからない」と答えたら、TODOマークして先に進む
- 機能要求は概要レベルで十分（詳細はL3で定義）
- 非機能要求も「体感的にストレスなく」程度の粒度で十分
</avoid_over_engineering>

## 前提処理

1. `skills/ssdd/templates/l1_vision.md` を読み込み、L1 テンプレートを確認する
2. **`docs/l1_vision.md` が存在するか確認**（再生成モード判定）

## 再生成モード（既存ファイルがある場合）

既存の `l1_vision.md` がある場合は**再生成モード**で動作する。

### モード判定

1. 既存ファイルを読み込み、現在の内容を把握
2. ユーザーに確認：「既存のL1があります。どうしますか？」
   - **追記**: 新しい要件を追加
   - **修正**: 既存の要件を変更
   - **深掘り**: 曖昧な箇所を詳細化
   - **最初から**: 既存を破棄して新規作成

### 保持するもの（上書きしない）

| セクション | 理由 |
|-----------|------|
| 既存のREQ ID | トレーサビリティ維持 |
| doc_statusがreviewed以上 | 承認済みを保護 |
| 更新履歴 | 変更経緯を保持 |

### 追記モード

- 新しい機能要求をヒアリング
- 既存REQ IDの最大値 + 1 で採番
- 追記箇所を明示してユーザーに確認

### 修正モード

- ユーザーに「どのREQを修正しますか？」と確認
- 変更理由を更新履歴に追記
- 影響範囲を報告（「このREQはL3のF-xxxで参照されています」）

### 深掘りモード

- TODOマークされた箇所を一覧表示
- 各TODOについて追加質問
- 回答を反映してTODOを解消

## 対話フロー（新規作成時）

### Step 1: プロダクト概要
1. プロダクト名は何ですか？
2. 解決したい課題は何ですか？
3. 想定ユーザー（ペルソナ）は誰ですか？

### Step 2: 制約条件
1. 動作環境（OS、ブラウザ等）は？
2. 法規制やコンプライアンス要件は？
3. 連携が必要な外部システムは？

### Step 3: 機能要求
1. 主な機能を教えてください
2. 各機能の優先度（高/中/低）は？
3. 参考にしたい類似サービスは？

### Step 4: 非機能要求
1. 性能要求は？（レスポンス時間等）
2. セキュリティ要件は？
3. その他の品質要求は？

## 出力仕様

- **ファイルパス**: `docs/l1_vision.md`
- **フロントマター**: `doc_status: draft`
- **曖昧箇所**: `<!-- TODO: 要確認 -->` でマーク
- **REQ ID**: タイムスタンプベース（REQ-YYYYMMDD-nnn）

## ID採番ロジック

1. 現在日時を取得: YYYYMMDD
2. 既存REQ IDを検索（Grepで docs/**/*.md から）
3. 同日の最大連番 + 1 で新ID生成

## 完了後の案内

- 作成ファイルのパスを報告
- `/draft-l2` で L2 生成できることを案内
