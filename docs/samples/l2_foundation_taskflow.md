---
id: L2-20251126-001
kind: foundation
layer: L2
status: active
doc_status: reviewed
---

# TaskFlow 技術基盤

## 1. ドキュメントの立ち位置

### 1.1 目的

本書は、TaskFlow の技術基盤（用語・技術選定・アーキテクチャ・NFR）の正本である。
本書の内容が確定した後、phases.md でフェーズ分け・機能一覧を定義する。

### 1.2 前提ドキュメント

- L1: [TaskFlow ビジョン・要求ドキュメント](./l1_vision_taskflow.md)

---

## 2. 用語集

| 用語 | 説明 |
|------|------|
| タスク | ユーザーが管理する作業単位。タイトル・期限・優先度・完了状態を持つ |
| プロジェクト | タスクをグループ化する単位。1つのプロジェクトに複数のタスクが属する |
| ワークスペース | チームでタスクを共有する単位。メンバー管理とプロジェクト管理を含む |
| 優先度 | タスクの重要度。高(P1)・中(P2)・低(P3)の3段階 |
| 期限 | タスクの完了予定日時 |
| 完了 | タスクが終了した状態。完了タスクはアーカイブ可能 |

---

## 3. アーキテクチャ概要

### 3.1 システム構成図

```
┌──────────────────────────────────────────────────────────┐
│                      Client Layer                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │   Browser   │  │  iOS App    │  │ Android App │       │
│  │   (React)   │  │  (将来対応)  │  │  (将来対応)  │       │
│  └──────┬──────┘  └─────────────┘  └─────────────┘       │
└─────────┼────────────────────────────────────────────────┘
          │ HTTPS
          ▼
┌──────────────────────────────────────────────────────────┐
│                      API Layer                            │
│  ┌──────────────────────────────────────────────┐        │
│  │              API Gateway (Nginx)              │        │
│  └──────────────────────┬───────────────────────┘        │
│                         │                                 │
│  ┌──────────────────────▼───────────────────────┐        │
│  │           Backend API (Node.js/Express)       │        │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────────────┐ │        │
│  │  │  Auth   │ │  Task   │ │    Project      │ │        │
│  │  │ Module  │ │ Module  │ │     Module      │ │        │
│  │  └─────────┘ └─────────┘ └─────────────────┘ │        │
│  └──────────────────────┬───────────────────────┘        │
└─────────────────────────┼────────────────────────────────┘
                          │
┌─────────────────────────┼────────────────────────────────┐
│                      Data Layer                           │
│  ┌──────────────────────▼───────────────────────┐        │
│  │              PostgreSQL                       │        │
│  │  (users, tasks, projects, workspaces)        │        │
│  └──────────────────────────────────────────────┘        │
│  ┌──────────────────────────────────────────────┐        │
│  │              Redis (Session/Cache)            │        │
│  └──────────────────────────────────────────────┘        │
└──────────────────────────────────────────────────────────┘
```

### 3.2 主要コンポーネント

| コンポーネント | 役割 | 技術 |
|---------------|------|------|
| Web Frontend | ブラウザ向けUI | React 18, TypeScript, TailwindCSS |
| API Server | REST API提供 | Node.js 20, Express, TypeScript |
| Database | データ永続化 | PostgreSQL 15 |
| Cache | セッション管理、キャッシュ | Redis 7 |
| API Gateway | リバースプロキシ、SSL終端 | Nginx |

---

## 4. 技術選定

### 4.1 フロントエンド

| 項目 | 選定技術 | 選定理由 |
|------|---------|----------|
| フレームワーク | React 18 | コンポーネント指向、エコシステムの充実、採用実績 |
| 言語 | TypeScript 5 | 型安全性、開発効率、バグ防止 |
| スタイリング | TailwindCSS 3 | ユーティリティファースト、カスタマイズ性、ビルドサイズ最適化 |
| 状態管理 | Zustand | 軽量、シンプルなAPI、React 18対応 |
| HTTP Client | Axios | 豊富な機能、インターセプター対応 |
| ビルドツール | Vite | 高速な開発サーバー、ESM対応 |

### 4.2 バックエンド

| 項目 | 選定技術 | 選定理由 |
|------|---------|----------|
| ランタイム | Node.js 20 LTS | フロントエンドとの言語統一、非同期I/O |
| フレームワーク | Express 4 | シンプル、豊富なミドルウェア、学習コスト低 |
| 言語 | TypeScript 5 | フロントエンドとの型共有、保守性 |
| ORM | Prisma | 型安全、マイグレーション管理、開発者体験 |
| 認証 | Passport.js + JWT | 柔軟な認証戦略、業界標準 |
| バリデーション | Zod | TypeScript統合、ランタイム検証 |

### 4.3 インフラストラクチャ

| 項目 | 選定技術 | 選定理由 |
|------|---------|----------|
| ホスティング | AWS (ECS Fargate) | スケーラビリティ、マネージドサービス |
| データベース | Amazon RDS (PostgreSQL) | マネージド運用、自動バックアップ |
| キャッシュ | Amazon ElastiCache (Redis) | マネージド運用、高可用性 |
| CDN | CloudFront | 静的アセット配信、レイテンシ低減 |
| CI/CD | GitHub Actions | GitHubとの統合、無料枠充実 |

---

## 5. ディレクトリ構成

```
taskflow/
├── docs/                    # ドキュメント
│   ├── l1_vision.md
│   ├── l2_system/
│   │   ├── foundation.md    # 本ドキュメント
│   │   ├── phases.md
│   │   └── rules.md
│   └── l3_features/
│       └── F-20251126-001_task_crud.md
├── frontend/                # Reactアプリケーション
│   ├── src/
│   │   ├── components/      # UIコンポーネント
│   │   ├── pages/           # ページコンポーネント
│   │   ├── hooks/           # カスタムフック
│   │   ├── stores/          # Zustand stores
│   │   ├── api/             # APIクライアント
│   │   └── types/           # 型定義
│   ├── package.json
│   └── vite.config.ts
├── backend/                 # Express APIサーバー
│   ├── src/
│   │   ├── controllers/     # リクエストハンドラ
│   │   ├── services/        # ビジネスロジック
│   │   ├── repositories/    # データアクセス
│   │   ├── middleware/      # ミドルウェア
│   │   ├── routes/          # ルーティング
│   │   └── types/           # 型定義
│   ├── prisma/
│   │   └── schema.prisma    # DBスキーマ
│   └── package.json
├── infrastructure/          # IaCコード
│   └── terraform/
└── README.md
```

---

## 6. API設計方針

### 6.1 基本方針

- RESTful設計に準拠
- JSONフォーマットで通信
- エラーレスポンスは統一フォーマット

### 6.2 認証

- JWT Bearer Token方式
- アクセストークン: 1時間有効
- リフレッシュトークン: 7日間有効

### 6.3 エンドポイント設計例

| メソッド | パス | 説明 |
|---------|------|------|
| POST | /api/v1/auth/register | ユーザー登録 |
| POST | /api/v1/auth/login | ログイン |
| GET | /api/v1/tasks | タスク一覧取得 |
| POST | /api/v1/tasks | タスク作成 |
| PATCH | /api/v1/tasks/:id | タスク更新 |
| DELETE | /api/v1/tasks/:id | タスク削除 |
| GET | /api/v1/projects | プロジェクト一覧取得 |

### 6.4 エラーレスポンス形式

```json
{
  "error": {
    "code": "TASK_NOT_FOUND",
    "message": "指定されたタスクが見つかりません",
    "details": {
      "taskId": "12345"
    }
  }
}
```

---

## 7. 非機能要求カタログ

| NF ID | 名称 | 説明 | カテゴリ | 優先度 | テスト方法 |
|-------|------|------|---------|--------|-----------|
| NF-20251126-001 | レスポンス性能 | API応答500ms以内 | 性能 | Must | 負荷テスト（k6） |
| NF-20251126-002 | 同時接続 | 1,000同時接続対応 | 性能 | Must | 負荷テスト（k6） |
| NF-20251126-003 | データ暗号化 | 通信はTLS 1.3、保存時AES-256 | セキュリティ | Must | セキュリティ監査 |
| NF-20251126-004 | 認証セキュリティ | パスワードbcryptハッシュ | セキュリティ | Must | コードレビュー |
| NF-20251126-005 | 可用性 | 月次稼働率99.5%以上 | 可用性 | Should | 監視ダッシュボード |
| NF-20251126-006 | バックアップ | 日次バックアップ、7日間保持 | 運用性 | Must | リストアテスト |
| NF-20251126-007 | ログ保持 | アプリケーションログ30日保持 | 運用性 | Should | 運用確認 |
| NF-20251126-008 | アクセシビリティ | WCAG 2.1 Level AA準拠 | ユーザビリティ | Should | axe-core自動テスト |

---

## 8. セキュリティ方針

### 8.1 認証・認可

- パスワード要件: 8文字以上、英数字記号混在
- ログイン試行制限: 5回失敗で15分ロック
- セッション管理: Redis、24時間タイムアウト

### 8.2 データ保護

- 通信: TLS 1.3必須
- 保存データ: RDS暗号化（AES-256）
- 個人情報: アクセスログ記録、90日保持

### 8.3 脆弱性対策

- OWASP Top 10対策を実施
- 依存パッケージの定期更新（Dependabot）
- SQLインジェクション: Prismaパラメータバインディング
- XSS: React自動エスケープ + CSPヘッダー

---

## 9. 監視・運用

### 9.1 監視項目

| 項目 | ツール | アラート条件 |
|------|-------|-------------|
| アプリケーションログ | CloudWatch Logs | ERROR以上を検知 |
| メトリクス | CloudWatch Metrics | CPU 80%超、メモリ 80%超 |
| 外形監視 | CloudWatch Synthetics | ヘルスチェック失敗 |
| エラートラッキング | Sentry | エラー発生時 |

### 9.2 アラート通知

- Slack #taskflow-alerts チャンネルに通知
- 重大障害はPagerDutyでオンコール通知

---

## 10. 次のステップ

本書の内容が確定（`doc_status: reviewed`）したら、以下を実施する：

1. `/gen-phases` でフェーズ定義・機能一覧を生成
2. `/draft-rules` で実装ルールを生成

---

## 11. 更新履歴

| 日付 | 版 | 変更内容 | 変更者 |
|------|---|---------|-------|
| 2025-11-26 | 1.0 | 初版作成 | 開発チーム |
