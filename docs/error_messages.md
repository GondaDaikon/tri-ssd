# SSDDエラーメッセージ標準化ガイド

すべてのコマンドで一貫性のあるエラーメッセージを提供するためのガイドです。

## 概要

SSDD の各コマンド（`/draft-l1`, `/draft-l2`, `/check` 等）で統一されたエラーメッセージフォーマットを使用することで、ユーザー体験を向上させます。

## エラーメッセージの原則

### 1. 明確性

- **何が問題か**を明確に伝える
- 技術的な詳細ではなく、ユーザー視点で説明
- 専門用語は最小限に

### 2. 実行可能性

- **どう解決するか**を具体的に示す
- 次のステップを明示
- 関連コマンドやドキュメントへのリンク

### 3. 一貫性

- 同じ種類のエラーには同じフォーマットを使用
- 用語の統一（「ファイル」vs「ドキュメント」等）
- 色分け・記号の統一

---

## エラーメッセージフォーマット

### 標準フォーマット

```
[レベル]: [問題の説明]

[詳細情報（オプション）]

解決方法:
1. [ステップ1]
2. [ステップ2]

[関連リンク（オプション）]
```

### レベル表示

| レベル | 記号 | 説明 | 使用場面 |
|--------|------|------|---------|
| ERROR | ✗ | エラー（実行不可） | 必須ファイル不在、必須引数欠落 |
| WARN | ⚠ | 警告（実行可能だが推奨しない） | 非推奨機能使用、潜在的問題 |
| INFO | ℹ | 情報（問題なし） | 処理の進捗、完了通知 |

---

## 標準エラーメッセージカタログ

### ファイル操作エラー

#### E001: ファイルが見つからない

```
✗ エラー: ファイルが見つかりません

ファイルパス: [path]

解決方法:
1. ファイルパスが正しいか確認してください
2. ファイルが存在するか確認してください: ls [path]

ヘルプ: /help [command]
```

**使用コマンド**: すべて
**終了コード**: 3

#### E002: ファイルが既に存在

```
⚠ 警告: ファイルが既に存在します

ファイルパス: [path]

以下から選択してください:
1. 上書き（既存内容は失われます）
2. スキップ（既存ファイルを保持）
3. 別名で保存
4. キャンセル
```

**使用コマンド**: /draft-l1, /draft-l2, /gen-l3
**終了コード**: 0（ユーザー選択待ち）

#### E003: ディレクトリが存在しない

```
✗ エラー: 出力先ディレクトリが存在しません

必要なディレクトリ: [path]

解決方法:
1. /init-ssdd を実行してディレクトリ構造を初期化
2. 手動でディレクトリを作成: mkdir -p [path]
```

**使用コマンド**: /draft-l1, /draft-l2, /gen-l3
**終了コード**: 1

### 引数エラー

#### E101: 必須引数が不足

```
✗ エラー: 必須引数が不足しています

使用方法: /[command] <引数>

例:
  /review docs/l1_vision.md
  /review F-20250125-001

ヘルプ: /help [command]
```

**使用コマンド**: すべて（引数必須コマンド）
**終了コード**: 2

#### E102: 不正な引数

```
✗ エラー: 不正な引数です

引数: [argument]
理由: [reason]

有効な値:
- [option1]
- [option2]
- [option3]

例: /[command] [valid-example]
```

**使用コマンド**: すべて
**終了コード**: 2

### ID関連エラー

#### E201: IDが見つからない

```
✗ エラー: 指定されたIDのドキュメントが見つかりません

ID: [ID]

存在するIDを確認:
  /check --list-ids

ID形式を確認してください（v0.1形式）:
- REQ-YYYYMMDD-nnn (例: REQ-20250125-001)
- F-YYYYMMDD-nnn (例: F-20250125-001)
- PH-YYYYMMDD-nnn (例: PH-20250125-001)
```

**使用コマンド**: /review, /check
**終了コード**: 3

#### E202: ID形式が不正

```
✗ エラー: ID形式が不正です

ID: [ID]

ID形式:
- REQ-YYYYMMDD-nnn (例: REQ-20250125-001)
- F-YYYYMMDD-nnn (例: F-20250125-001)
```

**使用コマンド**: すべて（ID指定時）
**終了コード**: 2

### フロントマターエラー

#### E301: 必須フィールド欠落

```
✗ エラー: フロントマターに必須フィールドが欠落しています

ファイル: [path]
欠落フィールド: [field]

必須フィールド:
- id: 一意なID
- kind: ドキュメント種別
- layer: 所属レイヤ（L1/L2/L3）
- status: ライフサイクル状態
- doc_status: 文書・開発状態

テンプレート: docs/frontmatter_spec.md
```

**使用コマンド**: /check, /review
**終了コード**: 1

#### E302: フィールド値が不正

```
✗ エラー: フロントマターのフィールド値が不正です

ファイル: [path]
フィールド: [field]
現在の値: [value]

有効な値:
- kind: vision, foundation, phase, rules, feature
- layer: L1, L2, L3
- status: active, deprecated, removed
- doc_status: draft, reviewed, implemented

詳細: docs/frontmatter_spec.md
```

**使用コマンド**: /check, /review
**終了コード**: 1

#### E303: タイトル見出しが欠落

```
✗ エラー: フロントマター直後にタイトル見出しがありません

ファイル: [path]

v0.1では`title`フィールドを廃止し、本文の`# 見出し`をタイトルとして使用します。

修正例:
---
id: F-20250125-001
kind: feature
layer: L3
status: active
doc_status: draft
---

# ユーザー認証機能  ← この行を追加

## 概要
...
```

**使用コマンド**: /check, /review
**終了コード**: 1

### 参照整合性エラー

#### E401: 参照先が存在しない

```
✗ エラー: 参照先のIDが存在しません

ファイル: [path]
参照フィールド: [field]
参照ID: [referenced-id]

確認方法:
  /check --list-ids | grep [referenced-id]

解決方法:
1. 参照IDが正しいか確認
2. 参照先ドキュメントが存在するか確認
3. 参照先を作成してから再度実行
```

**使用コマンド**: /check
**終了コード**: 1

#### E402: 循環依存を検出

### テンプレートエラー

#### E501: テンプレートが見つからない

```
✗ エラー: テンプレートが見つかりません

必要なファイル: [template-path]

解決方法:
1. /init-ssdd を実行してテンプレートを配置
2. 手動でテンプレートをコピー:
   ssdd-plugin/skills/ssdd/templates/ ディレクトリを確認

GitHub: https://github.com/your-org/ssdd/tree/main/docs/templates
```

**使用コマンド**: /draft-l1, /draft-l2, /gen-l3
**終了コード**: 1

### doc_status エラー

#### E601: 昇格条件未達

```
✗ エラー: doc_status の昇格条件を満たしていません

ファイル: [path]
現在の状態: [current]
昇格先: [target]

未達の条件:
✗ TODO が 3箇所残存しています
✗ 参照整合性エラーが 1件あります
✓ フロントマター必須フィールド: OK

修正後に再度レビューしてください:
  /review [path]
```

**使用コマンド**: /review
**終了コード**: 1

---

## 警告メッセージカタログ

### W001: 非推奨機能の使用

```
⚠ 警告: 非推奨機能を使用しています

機能: title フィールド（v0.1で廃止）
ファイル: [path]

本文の`# 見出し`を使用してください。

このまま続行できますが、将来のバージョンでエラーになります。
```

**使用コマンド**: /check, /review

### W002: TODO残存

```
⚠ 警告: TODO コメントが残存しています

ファイル: [path]
TODO数: [count]箇所

行番号:
- 42: <!-- TODO: 要確認 -->
- 58: <!-- TODO: 要確認 -->

draft → reviewed への昇格前に解消することを推奨します。
```

**使用コマンド**: /check, /review

### W003: deprecated への参照

```
⚠ 警告: deprecated 状態のIDを参照しています

ファイル: [path]
参照ID: [referenced-id] (status: deprecated)

後継ID: [replaced-by-id]

参照先を後継IDに更新することを推奨します。
```

**使用コマンド**: /check

---

## 情報メッセージ

### I001: 処理完了

```
✓ 処理が完了しました

作成されたファイル: [path]
ID: [id]
doc_status: draft

次のステップ:
1. 整合性チェック: /check
2. レビュー → 昇格: /review [id]
```

**使用コマンド**: /draft-l1, /draft-l2, /gen-l3

### I002: 進捗表示

```
ℹ 処理中...

[step] / [total-steps]: [description]
```

**使用コマンド**: すべて（長時間処理）

---

## コマンド別エラー一覧

### /draft-l1

| コード | エラー |
|--------|--------|
| E002 | 出力ファイルが既に存在 |
| E003 | 出力先ディレクトリが存在しない |
| E501 | テンプレートが見つからない |

### /draft-l2

| コード | エラー |
|--------|--------|
| E001 | L1ファイルが見つからない |
| E002 | 出力ファイルが既に存在 |
| E003 | 出力先ディレクトリが存在しない |
| E501 | テンプレートが見つからない |

### /gen-l3

| コード | エラー |
|--------|--------|
| E001 | L2ファイルが見つからない |
| E002 | 出力ファイルが既に存在 |
| E003 | 出力先ディレクトリが存在しない |
| E201 | 指定された機能IDが見つからない |
| E501 | テンプレートが見つからない |

### /check

| コード | エラー |
|--------|--------|
| E003 | docsディレクトリが存在しない |
| E301 | 必須フィールド欠落 |
| E302 | フィールド値が不正 |
| E303 | タイトル見出しが欠落 |
| E401 | 参照先が存在しない |
| E402 | 循環依存を検出 |
| W001 | title フィールド残存 |
| W002 | TODO残存 |
| W003 | deprecated への参照 |

### /review

| コード | エラー |
|--------|--------|
| E001 | ファイルが見つからない |
| E101 | 必須引数が不足 |
| E201 | IDが見つからない |
| E501 | テンプレートが見つからない |


---

## 実装ガイドライン

### 1. エラーメッセージの構造化

```javascript
// エラーメッセージオブジェクト
const error = {
  code: 'E001',
  level: 'ERROR',
  message: 'ファイルが見つかりません',
  details: {
    path: '/path/to/file.md'
  },
  solutions: [
    'ファイルパスが正しいか確認してください',
    'ファイルが存在するか確認してください: ls [path]'
  ],
  helpLink: '/help check'
};
```

### 2. エラー表示の統一

```javascript
function displayError(error) {
  const symbol = {
    'ERROR': '✗',
    'WARN': '⚠',
    'INFO': 'ℹ'
  }[error.level];

  console.error(`${symbol} ${error.level}: ${error.message}\n`);

  if (error.details) {
    Object.entries(error.details).forEach(([key, value]) => {
      console.error(`${key}: ${value}`);
    });
    console.error('');
  }

  if (error.solutions && error.solutions.length > 0) {
    console.error('解決方法:');
    error.solutions.forEach((solution, index) => {
      console.error(`${index + 1}. ${solution}`);
    });
    console.error('');
  }

  if (error.helpLink) {
    console.error(`ヘルプ: ${error.helpLink}`);
  }
}
```

### 3. 国際化対応（将来）

```javascript
// エラーメッセージの国際化
const messages = {
  en: {
    E001: 'File not found',
    // ...
  },
  ja: {
    E001: 'ファイルが見つかりません',
    // ...
  }
};

function getErrorMessage(code, lang = 'ja') {
  return messages[lang][code] || messages['en'][code];
}
```

---

## チェックリスト

エラーメッセージを追加・更新する際のチェックリスト：

- [ ] エラーコードを付与（E###, W###, I###）
- [ ] レベルを明確化（ERROR/WARN/INFO）
- [ ] 問題を明確に説明
- [ ] 具体的な解決方法を提示
- [ ] 関連ドキュメントへのリンク
- [ ] 終了コードを定義
- [ ] 使用コマンドを文書化
- [ ] カタログに追加

---

**更新日**: 2025-11-27
**対象バージョン**: SSDD v0.5
