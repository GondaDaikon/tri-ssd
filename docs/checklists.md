# SSDD 開発フロー・チェックリスト

## 1. フェーズと結合テスト／E2Eテスト

### 1.1 フェーズの定義

フェーズ（PH-YYYYMMDD-nnn）は、L1 の要求を満たすための機能群を「結合して動かしたときに意味のある単位」で束ねたマイルストーンです。

フェーズはイテレーションとは必ずしも1対1に対応しません。1フェーズが複数イテレーションをまたぐことも許容します。

### 1.2 L2 におけるフェーズ設計

L2 において、各フェーズについて以下を定義します：

- Phase ID／名称（PH-YYYYMMDD-nnn形式）
- 目的（ユーザー視点／アーキテクチャ視点）
- 対象機能（F-YYYYMMDD-nnn、記載順＝実装順）
- 適用非機能（NF-YYYYMMDD-nnn）
- 完了条件（Exit Criteria）
- フェーズ境界で実施するテストの種類と概要（結合テスト／E2Eテスト）

### 1.3 フェーズ境界でのテストとAI活用

各フェーズ完了時には、AI を用いて結合テスト／E2Eテストシナリオのドラフトを生成します。

**入力：**
- L2 のフェーズ定義
- 該当機能の L3 機能Doc

**出力：**
- シナリオ形式のテストケース案

**フロー：**
1. AI がテストシナリオ案を生成
2. テスター／開発者がレビュー・補正
3. テスト実施
4. テスト結果から得られた知見を反映：
   - 局所的な問題：L3（機能Doc）＋コードに反映
   - 構造／依存の問題：L2（フェーズ定義・機能構成）にフィードバック

---

## 2. 開発フロー（時系列）

### 2.1 標準フロー

```
┌──────────────────────────────────────────────────────────────┐
│  1. L1 にビジョン・要求（REQ-YYYYMMDD-nnn）を書く                │
│     └─ doc_status: draft → reviewed                         │
├──────────────────────────────────────────────────────────────┤
│  2. AI で L1 → L2 のドラフトを生成（対話的技術選定）              │
│     └─ 用語集／PH／F／NF（2ファイル構成）                       │
├──────────────────────────────────────────────────────────────┤
│  3. L2 をレビューし、フロントマターに情報を記載                   │
│     └─ doc_status: reviewed                                 │
├──────────────────────────────────────────────────────────────┤
│  4. 実装する F-YYYYMMDD-nnn を選び、L3 機能Doc を AI でドラフト生成│
├──────────────────────────────────────────────────────────────┤
│  5. L3 ドラフトをレビュー・補正                                 │
│     └─ doc_status: reviewed                                 │
├──────────────────────────────────────────────────────────────┤
│  6. 実装・テストを行い、L3・コード・テストを同期                  │
│     └─ doc_status: implemented                              │
├──────────────────────────────────────────────────────────────┤
│  7. フェーズ境界で AI 生成テストシナリオ＋結合／E2Eテストを実施     │
├──────────────────────────────────────────────────────────────┤
│  8. 結果を L3 → L2 → L1 に必要に応じてフィードバック             │
├──────────────────────────────────────────────────────────────┤
│  9. 適宜、AI による「全ドキュメント整合性チェック」を実行           │
│     └─ /check --list-ids で ID 一覧を生成                   │
└──────────────────────────────────────────────────────────────┘
```

### 2.2 チェックリスト形式

#### L1 作成時

- [ ] ビジョン・背景・目的を記載
- [ ] REQ-YYYYMMDD-nnn 形式で要件にIDを付与（タイムスタンプベース）
- [ ] フロントマターに id, kind, layer, status を記載
- [ ] フロントマター直後に `# 見出し` でタイトルを記載（v2.0: titleフィールドは廃止）
- [ ] doc_status を draft → reviewed に更新

#### L2 作成時

- [ ] AI で L1 → L2 ドラフトを生成（対話的技術選定）
- [ ] 用語集を確認・補正
- [ ] フェーズ定義（PH-YYYYMMDD-nnn）を確認・補正
- [ ] 機能一覧（F-YYYYMMDD-nnn）を確認・補正
- [ ] 非機能カタログ（NF-YYYYMMDD-nnn）を確認・補正
- [ ] フロントマターの参照フィールド（req_ids, nfr_ids, phase）でトレーサビリティを管理
- [ ] v2.0: 2ファイル構成（overview.md + phases.md）を確認
- [ ] doc_status を reviewed に更新

#### L3 作成時

- [ ] AI で L2 → L3 ドラフトを生成
- [ ] 概要・入出力を確認・補正
- [ ] 業務ルール・例外を確認・補正
- [ ] タスクチェックリストを確認・補正
- [ ] 受け入れ条件を確認・補正
- [ ] フロントマター直後に `# 見出し` でタイトルを記載（v2.0）
- [ ] doc_status を reviewed に更新

#### 実装時

- [ ] L3 を参照しつつ実装・テストを実施
- [ ] 実装メモに関連コードパス・注意点を追記
- [ ] doc_status を implemented に更新

#### フェーズ完了時

- [ ] Exit Criteria を満たしているか確認
- [ ] AI で結合テスト／E2Eテストシナリオを生成
- [ ] テストを実施
- [ ] 結果を L3 / L2 / L1 に反映

#### 定期チェック

- [ ] `/check --list-ids` で ID 一覧を生成し、孤立IDがないか確認
- [ ] AI で全ドキュメント整合性チェックを実行
- [ ] 切れたリンク・誤った参照を修正

---

## 3. v2.3 変更点: ライト版の廃止

### 3.1 廃止理由

v2.3以降、「ライト版運用」の概念を廃止しました。理由は以下の通りです：

#### 問題点

1. **曖昧な基準**: フル版とライト版の境界が不明瞭で、どちらを使うべきか判断が難しい
2. **ドキュメント整合性の低下**: ライト版運用では整合性チェックが疎かになりがち
3. **段階的移行の困難さ**: ライト版からフル版への移行時に大規模な再構成が必要
4. **AI活用の阻害**: 不完全なドキュメントではAI支援の効果が低下

#### v2.0-v2.2での改善により不要に

- **v2.0**: ID管理のシンプル化（タイムスタンプベース）、L2の2ファイル構成
- **v2.1**: doc_status遷移管理、ドメイン特化テンプレート
- **v2.2**: 定量的レビュー基準、エラーメッセージ標準化

これらの改善により、SSDD本体が十分に軽量化され、個人開発でも使いやすくなりました。

### 3.2 小規模プロジェクトでの推奨アプローチ

ライト版を使わず、以下のように**標準SSDDを段階的に導入**することを推奨します：

#### Phase 1: 最小構成（1-2週間）

- [ ] `/init-ssdd` で構造を初期化
- [ ] `/draft-l1` でL1ビジョン・要求を作成
- [ ] L1を`reviewed`に昇格（`/promote-status`）

#### Phase 2: 設計追加（2-4週間）

- [ ] `/gen-l2` でL2を生成（対話的技術選定）
- [ ] 2ファイル構成（overview.md + phases.md）を確認
- [ ] L2を`reviewed`に昇格

#### Phase 3: 機能開発（継続的）

- [ ] 実装する機能ごとに `/gen-l3` でL3生成
- [ ] 実装・テスト完了後、L3を`implemented`に昇格
- [ ] `/check` で定期的に整合性確認

#### Phase 4: 運用定着（継続的）

- [ ] `/review` でドキュメント品質チェック
- [ ] `/propagate-change` で変更影響分析
- [ ] 必要に応じて`/check --list-ids`でID一覧確認

### 3.3 個人開発での運用イメージ

**推奨**: 標準SSDDを採用し、以下の軽量運用で開始

- **L1**: 要件は箇条書きでもOK（AIが後で整形）
- **L2**: 2ファイル構成で十分（overview.md + phases.md）
- **L3**: 主要機能のみ作成し、補助機能は簡易メモでもOK
- **doc_status**: `draft → reviewed`の2段階でもOK（`implemented`はスキップ可）
- **整合性チェック**: リリース前や区切りで`/check`を実行

**重要**: ライト版との違いは「構造を守る」ことです。内容は簡潔でも、フロントマターとID管理は標準に従ってください。

### 3.4 移行ガイド（既存ライト版運用からの移行）

既にライト版運用をしている場合の移行手順：

#### Step 1: 現状把握

- [ ] 既存ドキュメントの棚卸し
- [ ] フロントマターの有無確認
- [ ] ID採番方式の確認（v1.x連番 vs v2.0タイムスタンプ）

#### Step 2: 構造の整備

- [ ] `/init-ssdd` で標準ディレクトリ構造を作成
- [ ] 既存L1/L2/L3を標準構造に配置
- [ ] フロントマター追加（`/convert-l1`等を活用）

#### Step 3: ID管理の統一

- [ ] 新規IDはv2.0形式（REQ-YYYYMMDD-nnn）を使用
- [ ] 既存IDはそのまま維持（混在OK）
- [ ] `/check --list-ids`で一覧を確認

#### Step 4: 段階的拡充

- [ ] L2の2ファイル構成を整備
- [ ] 主要機能のL3を追加
- [ ] `/check`で整合性を確認

詳細は`docs/migration_v2.md`を参照してください。
