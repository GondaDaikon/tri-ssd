# Tri-SSD 開発フロー・チェックリスト

開発フロー・段階的導入・チェックリストです。

> **前提**: フェーズ設計の概念については [guide.md セクション4.3](guide.md#43-フェーズ定義phase設計) を参照してください。

---

## 1. 開発フロー（時系列）

### 1.1 標準フロー

```
┌──────────────────────────────────────────────────────────────┐
│  1. L1 にビジョン・要求（REQ-YYYYMMDD-nnn）を書く                │
│     └─ doc_status: draft → reviewed                         │
├──────────────────────────────────────────────────────────────┤
│  2. /draft-l2 で L2 技術基盤を生成（対話的技術選定）                 │
│     └─ foundation.md に用語集・技術方針・NFRを定義               │
├──────────────────────────────────────────────────────────────┤
│  3. foundation.md をレビュー、doc_status: reviewed に更新        │
├──────────────────────────────────────────────────────────────┤
│  4. /gen-phases でフェーズ定義・機能一覧を生成                    │
│     └─ 環境構築フェーズを含む計画を作成                         │
├──────────────────────────────────────────────────────────────┤
│  5. /draft-rules で実装ルールのたたき台を生成                      │
│     └─ L3実装を通じて継続的に更新                              │
├──────────────────────────────────────────────────────────────┤
│  6. 実装する F-YYYYMMDD-nnn を選び、L3 機能Doc を AI でドラフト生成│
├──────────────────────────────────────────────────────────────┤
│  7. L3 ドラフトをレビュー・補正                                 │
│     └─ doc_status: reviewed                                 │
├──────────────────────────────────────────────────────────────┤
│  8. 実装・テストを行い、L3・コード・テストを同期                  │
│     └─ doc_status: implemented                              │
├──────────────────────────────────────────────────────────────┤
│  9. フェーズ境界で AI 生成テストシナリオ＋結合／E2Eテストを実施     │
├──────────────────────────────────────────────────────────────┤
│ 10. 結果を L3 → L2 → L1 に必要に応じてフィードバック             │
│     └─ 汎用的な問題は rules.md に追記                         │
├──────────────────────────────────────────────────────────────┤
│ 11. 適宜、AI による「全ドキュメント整合性チェック」を実行           │
│     └─ /check --list-ids で ID 一覧を生成                   │
└──────────────────────────────────────────────────────────────┘
```

### 1.2 チェックリスト形式

#### L1 作成時

- [ ] ビジョン・背景・目的を記載
- [ ] REQ-YYYYMMDD-nnn 形式で要件にIDを付与（タイムスタンプベース）
- [ ] フロントマターに id, kind, layer, status を記載
- [ ] フロントマター直後に `# 見出し` でタイトルを記載（titleフィールドは廃止）
- [ ] doc_status を draft → reviewed に更新

#### L2 作成時

- [ ] `/draft-l2` で L1 → L2 技術基盤を生成（対話的技術選定）
- [ ] 用語集を確認・補正
- [ ] 技術スタック・アーキテクチャを確認・補正
- [ ] 非機能カタログ（NF-YYYYMMDD-nnn）を確認・補正
- [ ] foundation.md の doc_status を reviewed に更新
- [ ] `/gen-phases` でフェーズ定義・機能一覧を生成
- [ ] フェーズ定義（PH-YYYYMMDD-nnn）を確認・補正
- [ ] 機能一覧（F-YYYYMMDD-nnn）を確認・補正
- [ ] フロントマターの参照フィールド（req_ids, nfr_ids, phase）でトレーサビリティを管理
- [ ] phases.md の doc_status を reviewed に更新
- [ ] `/draft-rules` で実装ルールのたたき台を生成（任意、L3実装前に推奨）

#### L3 作成時

- [ ] AI で L2 → L3 ドラフトを生成
- [ ] 概要・入出力を確認・補正
- [ ] 業務ルール・例外を確認・補正
- [ ] タスクチェックリストを確認・補正
- [ ] 受け入れ条件を確認・補正
- [ ] フロントマター直後に `# 見出し` でタイトルを記載（titleフィールドは廃止）
- [ ] doc_status を reviewed に更新

#### 実装時

- [ ] L3 を参照しつつ実装・テストを実施
- [ ] 実装メモに関連コードパス・注意点を追記
- [ ] doc_status を implemented に更新

#### フェーズ完了時

- [ ] Exit Criteria を満たしているか確認
- [ ] AI で結合テスト／E2Eテストシナリオを生成
- [ ] テストを実施
- [ ] 結果を L3 / L2 / L1 に反映

#### 定期チェック

- [ ] `/check --list-ids` で ID 一覧を生成し、孤立IDがないか確認
- [ ] AI で全ドキュメント整合性チェックを実行
- [ ] 切れたリンク・誤った参照を修正

---

## 2. 小規模プロジェクトでの推奨アプローチ

以下のように**標準Tri-SSDを段階的に導入**することを推奨します：

### Phase 1: 最小構成（1-2週間）

- [ ] `/init-tri-ssd` で構造を初期化
- [ ] `/draft-l1` でL1ビジョン・要求を作成
- [ ] `/review` でL1をレビュー → `reviewed`に昇格

### Phase 2: 設計追加（2-4週間）

- [ ] `/draft-l2` でL2技術基盤を生成（対話的技術選定）
- [ ] foundation.mdを`reviewed`に昇格
- [ ] `/gen-phases` でフェーズ定義・機能一覧を生成
- [ ] phases.mdを`reviewed`に昇格
- [ ] `/draft-rules` で実装ルールを生成（任意）

### Phase 3: 機能開発（継続的）

- [ ] 実装する機能ごとに `/gen-l3` でL3生成
- [ ] 実装・テスト完了後、L3を`implemented`に昇格
- [ ] `/check` で定期的に整合性確認

### Phase 4: 運用定着（継続的）

- [ ] `/review` でドキュメント品質チェック
- [ ] 必要に応じて`/check --list-ids`でID一覧確認

### 2.1 個人開発での運用イメージ

**推奨**: 標準Tri-SSDを採用し、以下の軽量運用で開始

- **L1**: 要件は箇条書きでもOK（AIが後で整形）
- **L2**: 2ファイル構成で十分（foundation.md + phases.md）
- **L3**: 主要機能のみ作成し、補助機能は簡易メモでもOK
- **doc_status**: `draft → reviewed`の2段階でもOK（`implemented`はスキップ可）
- **整合性チェック**: リリース前や区切りで`/check`を実行

**重要**: ライト版との違いは「構造を守る」ことです。内容は簡潔でも、フロントマターとID管理は標準に従ってください。

### 2.2 移行ガイド（既存ライト版運用からの移行）

既にライト版運用をしている場合の移行手順：

#### Step 1: 現状把握

- [ ] 既存ドキュメントの棚卸し
- [ ] フロントマターの有無確認
- [ ] ID採番方式の確認（タイムスタンプベース）

#### Step 2: 構造の整備

- [ ] `/init-tri-ssd` で標準ディレクトリ構造を作成
- [ ] 既存L1/L2/L3を標準構造に配置
- [ ] フロントマター追加（`/draft-l1 <ファイルパス>` で変換モードを活用）

#### Step 3: ID管理の統一

- [ ] 新規IDはタイムスタンプ形式（REQ-YYYYMMDD-nnn）を使用
- [ ] 既存IDはそのまま維持（混在OK）
- [ ] `/check --list-ids`で一覧を確認

#### Step 4: 段階的拡充

- [ ] L2の2ファイル構成を整備
- [ ] 主要機能のL3を追加
- [ ] `/check`で整合性を確認

---

## 3. バリデーションコマンド

### 3.1 `/check` - 整合性チェック

すべてのドキュメントの構造・参照整合性を自動チェックします。

```bash
/check              # 全体チェック
/check --list-ids   # ID一覧表示
/check docs/l1_vision.md  # 特定ファイルのみ
```

**チェック項目**:

| カテゴリ | チェック内容 |
|---------|------------|
| フロントマター | 必須フィールド（id, kind, layer, status, doc_status） |
| タイトル | フロントマター直後に `# 見出し` が存在するか |
| 参照整合性 | req_ids, nfr_ids, phase の参照先が存在するか |
| ID重複 | 同一IDが複数ファイルに存在しないか |
| 孤立検出 | フェーズ・要件に紐付かないL3がないか |

### 3.2 `/review` - 品質レビュー＋ステータス昇格

個別ドキュメントの内容品質をAIがレビューし、ステータス昇格を提案します。

```bash
/review docs/l1_vision.md   # ファイルパスで指定
/review F-20250125-001      # IDで指定
```

**レビュー観点（レイヤ別）**:

| レイヤ | 主なチェック |
|--------|------------|
| L1 | 技術詳細が混入していないか、REQ形式か |
| L2 | L1のREQがカバーされているか、技術選定理由があるか |
| L3 | 受け入れ条件がテスト可能か、タスク粒度は適切か |

**ステータス昇格**:
- `draft → reviewed`: レビュー後、問題なければ昇格
- `reviewed → implemented`: L3のみ、実装完了後に昇格

### 3.3 使い分けガイド

| 状況 | 使うコマンド |
|------|------------|
| 1ファイルの変更後 | `/review` |
| 複数ファイルの変更後 | `/check` → 問題なければ `/review` |
| リリース前 | `/check` で全体確認 |
| `draft → reviewed` 昇格前 | `/review` |
| 定期チェック（週次等） | `/check` |
