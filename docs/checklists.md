# SSDD 開発フロー・チェックリスト

## 1. フェーズと結合テスト／E2Eテスト

### 1.1 フェーズの定義

フェーズ（PH-xxxx）は、L1 の要求を満たすための機能群を「結合して動かしたときに意味のある単位」で束ねたマイルストーンです。

フェーズはイテレーションとは必ずしも1対1に対応しません。1フェーズが複数イテレーションをまたぐことも許容します。

### 1.2 L2 におけるフェーズ設計

L2 において、各フェーズについて以下を定義します：

- Phase ID／名称
- 目的（ユーザー視点／アーキテクチャ視点）
- 対象機能（F-xxxx、記載順＝実装順）
- 適用非機能（NF-xxxx）
- 完了条件（Exit Criteria）
- フェーズ境界で実施するテストの種類と概要（結合テスト／E2Eテスト）

### 1.3 フェーズ境界でのテストとAI活用

各フェーズ完了時には、AI を用いて結合テスト／E2Eテストシナリオのドラフトを生成します。

**入力：**
- L2 のフェーズ定義
- 該当機能の L3 機能Doc

**出力：**
- シナリオ形式のテストケース案

**フロー：**
1. AI がテストシナリオ案を生成
2. テスター／開発者がレビュー・補正
3. テスト実施
4. テスト結果から得られた知見を反映：
   - 局所的な問題：L3（機能Doc）＋コードに反映
   - 構造／依存の問題：L2（フェーズ定義・機能構成）にフィードバック

---

## 2. 開発フロー（時系列）

### 2.1 標準フロー

```
┌─────────────────────────────────────────────────────────┐
│  1. L1 にビジョン・要求（REQ-xxxx）を書く                    │
│     └─ doc_status: draft → reviewed                     │
├─────────────────────────────────────────────────────────┤
│  2. AI で L1 → L2 のドラフトを生成                          │
│     └─ 用語集／PH／F／NF                                 │
├─────────────────────────────────────────────────────────┤
│  3. L2 をレビューし、フロントマターに情報を記載                │
│     └─ doc_status: reviewed                             │
├─────────────────────────────────────────────────────────┤
│  4. 実装する F-xxxx を選び、L3 機能Doc を AI でドラフト生成    │
├─────────────────────────────────────────────────────────┤
│  5. L3 ドラフトをレビュー・補正                              │
│     └─ doc_status: reviewed                             │
├─────────────────────────────────────────────────────────┤
│  6. 実装・テストを行い、L3・コード・テストを同期               │
│     └─ doc_status: implemented                          │
├─────────────────────────────────────────────────────────┤
│  7. フェーズ境界で AI 生成テストシナリオ＋結合／E2Eテストを実施  │
├─────────────────────────────────────────────────────────┤
│  8. 結果を L3 → L2 → L1 に必要に応じてフィードバック          │
├─────────────────────────────────────────────────────────┤
│  9. 適宜、AI による「全ドキュメント整合性チェック」を実行        │
│     └─ /check --list-ids で ID 一覧を生成               │
└─────────────────────────────────────────────────────────┘
```

### 2.2 チェックリスト形式

#### L1 作成時

- [ ] ビジョン・背景・目的を記載
- [ ] REQ-xxxx 形式で要件にIDを付与
- [ ] フロントマターに id, kind, layer, status を記載
- [ ] doc_status を draft → reviewed に更新

#### L2 作成時

- [ ] AI で L1 → L2 ドラフトを生成
- [ ] 用語集を確認・補正
- [ ] フェーズ定義（PH-xxxx）を確認・補正
- [ ] 機能一覧（F-xxxx）を確認・補正
- [ ] 非機能カタログ（NF-xxxx）を確認・補正
- [ ] フロントマターの参照フィールド（req_ids, nfr_ids, phase）でトレーサビリティを管理
- [ ] doc_status を reviewed に更新

#### L3 作成時

- [ ] AI で L2 → L3 ドラフトを生成
- [ ] 概要・入出力を確認・補正
- [ ] 業務ルール・例外を確認・補正
- [ ] タスクチェックリストを確認・補正
- [ ] 受け入れ条件を確認・補正
- [ ] doc_status を reviewed に更新

#### 実装時

- [ ] L3 を参照しつつ実装・テストを実施
- [ ] 実装メモに関連コードパス・注意点を追記
- [ ] doc_status を implemented に更新

#### フェーズ完了時

- [ ] Exit Criteria を満たしているか確認
- [ ] AI で結合テスト／E2Eテストシナリオを生成
- [ ] テストを実施
- [ ] 結果を L3 / L2 / L1 に反映

#### 定期チェック

- [ ] `/check --list-ids` で ID 一覧を生成し、孤立IDがないか確認
- [ ] AI で全ドキュメント整合性チェックを実行
- [ ] 切れたリンク・誤った参照を修正

---

## 3. ライト版運用

### 3.1 SSDD フル版が有効なケース

- ドメイン／業務ロジックが複雑で、要件ドキュメントが大きくなりがち
- 今後も要求変更が継続することが見込まれる
- AI ツールの利用が許容されており、LLM に要件・コードを読ませられる環境がある

### 3.2 ライト版運用の例

小規模・短期案件では、以下のような簡略版も許容します。

| 項目 | フル版 | ライト版 |
|------|--------|---------|
| L1 | 詳細な要求ドキュメント | 課題・ペルソナ・願望リストをラフに記載 |
| L2 | 詳細なフェーズ・機能構成 | 軽量な技術メモ＋簡易機能一覧 |
| L3 | 全機能に機能Doc | 主要機能のみ機能Doc |
| フェーズ | 明示的に定義 | 定義せず、イテレーション単位でテスト |
| NF | 詳細な非機能カタログ | 最小限に絞る |

**ライト版でも維持すること：**
- L1 が要件の正本
- 技術方針・機能構成の正は簡略版 L2 に置く

### 3.3 規模別の導入ステップ

| Step | 内容 |
|------|------|
| Step1 | L1 と L3 のみを導入し、「L3 を AI に渡してコードを書く」運用から始める |
| Step2 | L2 にフェーズ（PH）と機能一覧（F）を追加し、L1→L2→L3 のパスを AI に張らせる |
| Step3 | フロントマターを整備し、AI による整合性チェックを時々走らせる |

### 3.4 ライト版チェックリスト

#### 最小構成

- [ ] L1: vision.md に「何を作りたいか」を記載
- [ ] L3: 主要機能の機能Doc を作成
- [ ] AI で L3 → コード生成を実行

#### 段階的拡張

- [ ] L2: 簡易な技術メモ・機能一覧を追加
- [ ] フロントマターにメタ情報を追加
- [ ] AI で整合性チェックを実行
