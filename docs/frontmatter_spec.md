# SSDD フロントマター仕様

> **バージョン**: v0.5
> **対象範囲**: フロントマター仕様・共通ルール

## 概要

SSDDドキュメントのフロントマター仕様を定義します。

## テンプレート一覧

テンプレートは `ssdd-plugin/skills/ssdd/templates/` に配置されています。

| ファイル | 用途 |
|---------|------|
| l1_vision.md | L1 ビジョン・要求ドキュメント |
| l2_overview.md | L2 概要（用語集・技術方針・全体構成） |
| l2_phases.md | L2 フェーズ定義 |
| l2_rules.md | L2 実装ルール（コード生成制約） |
| l3_feature.md | L3 機能ドキュメント |

> **Note**: L3テンプレートは汎用テンプレート1つのみです。ドメイン固有の考慮事項（セキュリティ、デプロイ、プラットフォーム対応等）はL2の技術方針・NFRカタログで定義し、L3生成時にAIがコンテキストに応じて適切な内容を生成します。

---

## YAML フロントマター仕様

### 基本方針

- 単一IDを表す Markdown ファイルは、先頭に YAML フロントマターを持つ
- 本文内に同じメタ情報を重複して書かず、**フロントマターをメタ情報の正本**とする
- AI も、まずフロントマターを参照してから本文を処理する

### 共通フィールド

```yaml
---
id: F-YYYYMMDD-nnn     # 一意なID（タイムスタンプベース）
kind: feature          # ドキュメント種別
layer: L3              # 所属レイヤ
status: active         # ライフサイクル状態
doc_status: draft      # 文書・開発状態
---

# ユーザー認証機能  # ← 本文の見出しがタイトルとして扱われる（v0.1）
```

| フィールド | 必須 | 説明 |
|-----------|------|------|
| id | ○ | 一意なID（REQ-YYYYMMDD-nnn, F-YYYYMMDD-nnn 等） |
| kind | ○ | ドキュメント種別（下記参照） |
| layer | ○ | 所属レイヤ（L1 / L2 / L3 / meta） |
| status | ○ | ライフサイクル状態（下記参照） |
| doc_status | ○ | 文書・開発状態（下記参照） |

**重要**: v0.1以降、`title`フィールドは廃止されました。本文の最初の`# 見出し`がドキュメントのタイトルとして扱われます。これにより、フロントマターと本文の同期問題を根本的に解決します。

### kind（ドキュメント種別）

| 値 | 説明 |
|----|------|
| vision | ビジョンドキュメント（L1） |
| overview | L2概要（用語集・技術方針・アーキテクチャ） |
| phase | フェーズ定義（L2） |
| rules | 実装ルール（L2、コード生成制約） |
| feature | 機能ドキュメント（L3） |

> **Note**: 要件（REQ-xxx）はL1ビジョン内でインライン定義、非機能要求（NF-xxx）はL2概要内で定義します。

### status（ライフサイクル状態）

| 値 | 説明 |
|----|------|
| active | 現役。変更・拡張の対象 |
| deprecated | 廃止予定・移行中。可能であれば `replaced_by` で後継IDを記録 |
| removed | 廃止済み。履歴としてのみ残し、新規からは参照しない |

### doc_status（文書・開発状態）

| 値 | 説明 |
|----|------|
| draft | AIドラフトや書きかけ。レビュー前 |
| reviewed | 人間が内容を確認し、実装／運用に使えるレベル |
| implemented | 実装・テスト完了済みで、ドキュメントも追従している（主にL3） |

---

## 参照フィールド（トレーサビリティ用）

L2/L3 ドキュメントでは、以下の参照フィールドを使用してトレーサビリティを確保します。

```yaml
---
id: F-YYYYMMDD-nnn
kind: feature
layer: L3
status: active
doc_status: reviewed
req_ids:              # 対応する要件ID
  - REQ-YYYYMMDD-nnn
nfr_ids:              # 適用される非機能要求ID
  - NF-YYYYMMDD-nnn
phase: PH-YYYYMMDD-nnn  # 所属フェーズ
---

# Markdown編集機能  # ← 本文の見出しがタイトル（v0.1）
```

| フィールド | 説明 |
|-----------|------|
| req_ids | この機能が対応する要件ID（REQ-xxxx）のリスト |
| nfr_ids | この機能に適用される非機能要求ID（NF-xxxx）のリスト |
| phase | この機能が所属するフェーズID（PH-xxxx） |
| related_nfr_ids | 関連する非機能要求ID（フェーズ定義などで使用） |
| replaced_by | status: deprecated の場合、後継となるID |

---

## 規模別の運用イメージ

### 個人開発

- `doc_status` は `draft / reviewed / implemented` の3つに絞ってよい
- AI がドラフトを生成した直後は `draft`
- 自分で読み直して「一旦これで進める」と判断したら `reviewed`
- 実装とテストを終えて内容をざっくり追随させたら `implemented`

### 小〜中規模チーム

- `reviewed` にする際に、誰がレビューしたか（reviewer）を PR やコメントで残すことを推奨
- 重要な設計（アーキテクチャ方針など）は、`reviewed` への変更を特定ロール（アーキテクト等）に限定することも検討

---

## AI による整合性チェック

フロントマターを正本としているため、以下のチェックを AI に依頼できます：

- 各ドキュメントの `id / kind / layer / status` の妥当性
- `req_ids / nfr_ids / phase` の参照先が存在するか
- 孤立したID・切れたリンク・誤った参照の検出

> ID一覧が必要な場合は `/check --list-ids` で動的生成します。
