---
id: F-YYYYMMDD-nnn
kind: feature
layer: L3
status: active
doc_status: draft
req_ids:
  - REQ-YYYYMMDD-nnn
nfr_ids:
  - NF-YYYYMMDD-nnn
phase: PH-YYYYMMDD-nnn
---

# [機能名]

> **ドメイン**: Webアプリケーション
> **テンプレートバージョン**: v2.0

## 1. 概要

### 1.1 この機能でできること

[この機能でユーザーが何をできるようになるか、1〜3文で説明]

### 1.2 代表的なユースケース

**ユースケース1**: [シナリオ名]
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

**ユースケース2**: [シナリオ名]
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

---

## 2. 画面・API設計

### 2.1 画面構成

#### ページURL

- **パス**: `/[path]`
- **メソッド**: GET / POST
- **認証**: 必要 / 不要
- **ロール**: [ロール名]

#### 画面レイアウト

```
┌─────────────────────────────────────────────────┐
│  [ヘッダー]                        [ユーザーメニュー] │
├─────────────────────────────────────────────────┤
│  [ナビゲーション]  │  [メインコンテンツ]            │
│  ・[メニュー1]     │  ┌─────────────────────┐    │
│  ・[メニュー2]     │  │  [タイトル]          │    │
│  ・[メニュー3]     │  ├─────────────────────┤    │
│                   │  │  [フォーム要素1]     │    │
│                   │  │  [フォーム要素2]     │    │
│                   │  │  [ボタン: 実行]      │    │
│                   │  └─────────────────────┘    │
└─────────────────────────────────────────────────┘
```

#### UIコンポーネント

| コンポーネント | 種類 | 説明 |
|--------------|------|------|
| [コンポーネント名1] | [Button/Input/Table/etc] | [説明] |
| [コンポーネント名2] | [種類] | [説明] |

### 2.2 API設計

#### エンドポイント1: [操作名]

**リクエスト**:
```http
POST /api/v1/[endpoint]
Content-Type: application/json
Authorization: Bearer {token}

{
  "field1": "value1",
  "field2": "value2"
}
```

**レスポンス（成功時）**:
```json
{
  "status": "success",
  "data": {
    "id": "xxx",
    "field1": "value1"
  }
}
```

**レスポンス（エラー時）**:
```json
{
  "status": "error",
  "code": "ERROR_CODE",
  "message": "エラーメッセージ",
  "details": {
    "field": "field1",
    "reason": "詳細な理由"
  }
}
```

**エラーコード**:

| コード | HTTPステータス | 説明 |
|--------|---------------|------|
| VALIDATION_ERROR | 400 | 入力値エラー |
| UNAUTHORIZED | 401 | 認証エラー |
| FORBIDDEN | 403 | 権限エラー |
| NOT_FOUND | 404 | リソース未存在 |
| CONFLICT | 409 | 競合エラー |
| INTERNAL_ERROR | 500 | サーバーエラー |

### 2.3 状態遷移

```
[初期状態] ─────> [ローディング] ─────> [データ表示]
                                           │
                                           ├─> [編集モード]
                                           │     │
                                           │     └─> [保存中]
                                           │           │
                                           │           └─> [完了]
                                           │
                                           └─> [エラー状態]
```

### 2.4 インタラクション

| ユーザー操作 | システム応答 | 次の状態 |
|------------|-------------|---------|
| [操作1] | [応答1] | [状態1] |
| [操作2] | [応答2] | [状態2] |

---

## 3. 業務ルール・例外

### 3.1 バリデーションルール

#### フロントエンド（即時フィードバック）

| 項目 | ルール | エラーメッセージ | 表示タイミング |
|------|--------|-----------------|---------------|
| [項目名1] | 必須 | 「[項目名]は必須です」 | onBlur |
| [項目名2] | 最大100文字 | 「100文字以内で入力してください」 | onChange |
| [項目名3] | メール形式 | 「正しいメール形式で入力してください」 | onBlur |

#### バックエンド（最終検証）

| 項目 | ルール | エラーコード | エラーメッセージ |
|------|--------|-------------|-----------------|
| [項目名1] | 必須、型チェック | VALIDATION_ERROR | [詳細メッセージ] |
| [項目名2] | 重複チェック | CONFLICT | [詳細メッセージ] |

### 3.2 権限・ロールによる振る舞い

| ロール | 許可される操作 | 制限事項 |
|--------|---------------|---------|
| [ロール1] | 閲覧のみ | 編集・削除不可 |
| [ロール2] | 閲覧・編集 | 削除不可 |
| [ロール3] | すべて | なし |

### 3.3 例外的なケース

| ケース | 動作 |
|--------|------|
| [例外ケース1] | [動作説明] |
| [例外ケース2] | [動作説明] |

---

## 4. タスクチェックリスト

### 4.1 実装タスク

#### フロントエンド

- [ ] ページコンポーネント作成（`src/pages/[page-name].tsx`）
- [ ] UIコンポーネント実装（`src/components/[component-name].tsx`）
- [ ] 状態管理実装（Redux/Zustand/etc）
- [ ] API クライアント実装（`src/api/[api-name].ts`）
- [ ] バリデーション実装（フロントエンド）
- [ ] ローディング状態の実装
- [ ] エラーハンドリングの実装
- [ ] レスポンシブ対応（モバイル・タブレット）

#### バックエンド

- [ ] API エンドポイント実装（`/api/v1/[endpoint]`）
- [ ] リクエスト/レスポンスのスキーマ定義
- [ ] バリデーション実装（バックエンド）
- [ ] ビジネスロジック実装
- [ ] データベース操作（CRUD）
- [ ] トランザクション管理
- [ ] エラーハンドリング
- [ ] 認証・認可の実装

#### その他

- [ ] ルーティング設定
- [ ] 環境変数の設定
- [ ] ログ出力の実装

### 4.2 テストタスク

#### ユニットテスト

- [ ] コンポーネントテスト（`[component-name].test.tsx`）
- [ ] カスタムフックテスト（`[hook-name].test.ts`）
- [ ] ビジネスロジックテスト（`[logic-name].test.ts`）
- [ ] API エンドポイントテスト（`[endpoint].test.ts`）

#### 結合テスト

- [ ] API 結合テスト（フロントエンド ↔ バックエンド）
- [ ] データベース結合テスト

#### E2Eテスト

- [ ] 主要ユースケースのE2Eテスト（Playwright/Cypress）
- [ ] エラーケースのE2Eテスト

#### その他

- [ ] パフォーマンステスト
- [ ] セキュリティテスト（XSS, CSRF対策）
- [ ] アクセシビリティテスト（axe DevTools）

---

## 5. 非機能・受け入れ条件

### 5.1 非機能要求の具体化

| NF ID | 要求 | この機能での具体化 |
|-------|------|-------------------|
| NF-YYYYMMDD-nnn | レスポンス性能 | 初期表示3秒以内、操作レスポンス1秒以内 |
| NF-YYYYMMDD-nnn | アクセシビリティ | WCAG 2.2 AA準拠、キーボード操作対応 |
| NF-YYYYMMDD-nnn | セキュリティ | CSRF対策、XSS対策、入力サニタイズ |

### 5.2 受け入れ条件

#### AC-1: [条件名]

```gherkin
Given [前提条件]
When [操作・アクション]
Then [期待される結果]
```

#### AC-2: [条件名]

```gherkin
Given [前提条件]
When [操作・アクション]
Then [期待される結果]
```

#### AC-3: [エラーハンドリング]

```gherkin
Given [前提条件]
When [エラー発生条件]
Then [エラー時の振る舞い]
```

### 5.3 パフォーマンス基準

| メトリクス | 目標値 | 測定方法 |
|-----------|--------|---------|
| 初期表示時間 | 3秒以内 | Lighthouse |
| インタラクション遅延 | 1秒以内 | 手動計測 |
| バンドルサイズ | 500KB以内 | webpack-bundle-analyzer |
| API レスポンス | 500ms以内 | サーバーログ |

---

## 6. 実装メモ・注意点

### 6.1 適用した設計パターン

- **[パターン名1]**: [適用理由・概要]
- **[パターン名2]**: [適用理由・概要]

### 6.2 関連コードへのリンク

| 種別 | パス |
|------|------|
| ページコンポーネント | `src/pages/[page-name].tsx` |
| UIコンポーネント | `src/components/[component-name]/` |
| API クライアント | `src/api/[api-name].ts` |
| 状態管理 | `src/store/[slice-name].ts` |
| バックエンドAPI | `api/v1/[endpoint].ts` |
| テストコード | `tests/features/[feature-name]/` |

### 6.3 技術的負債・暫定対応

- [ ] [負債1：何が暫定で、どう直すべきか]
- [ ] [負債2]

### 6.4 注意点・申し送り事項

- [注意点1]
- [注意点2]

### 6.5 Web固有の考慮事項

#### ブラウザ対応

| ブラウザ | バージョン | 対応状況 |
|---------|-----------|---------|
| Chrome | 最新版 | ✓ |
| Firefox | 最新版 | ✓ |
| Safari | 最新版 | ✓ |
| Edge | 最新版 | ✓ |

#### レスポンシブ対応

| デバイス | ブレークポイント | 対応内容 |
|---------|----------------|---------|
| スマートフォン | 〜768px | [対応内容] |
| タブレット | 768px〜1024px | [対応内容] |
| デスクトップ | 1024px〜 | [対応内容] |

#### PWA対応

- [ ] Service Worker 登録
- [ ] オフライン対応
- [ ] プッシュ通知
- [ ] インストール可能

---

## 7. セキュリティチェックリスト

### 7.1 OWASP Top 10 対策

- [ ] **Injection**: SQLインジェクション、XSS対策
  - パラメータ化クエリ使用
  - 入力サニタイズ実装
  - Content Security Policy設定

- [ ] **認証の不備**: 認証・セッション管理
  - HTTPOnly Cookie使用
  - セキュアなトークン管理
  - 多要素認証対応（該当する場合）

- [ ] **機密データの露出**: データ保護
  - HTTPS通信
  - 機密情報のログ出力禁止
  - 適切な暗号化

- [ ] **CSRF**: クロスサイトリクエストフォージェリ対策
  - CSRFトークン実装
  - SameSite Cookie属性設定

### 7.2 セキュリティテスト

- [ ] 自動スキャン（OWASP ZAP等）
- [ ] 手動ペネトレーションテスト
- [ ] コードレビュー（セキュリティ観点）

---

## 8. デプロイメント・運用

### 8.1 デプロイ前チェック

- [ ] 環境変数の設定確認
- [ ] ビルドエラーなし
- [ ] すべてのテストがパス
- [ ] パフォーマンス基準を満たす
- [ ] セキュリティチェック完了

### 8.2 監視・ログ

| 項目 | 監視内容 | アラート条件 |
|------|---------|-------------|
| エラー率 | エラー発生率 | 5%超過 |
| レスポンス時間 | API応答時間 | 1秒超過 |
| 稼働率 | サービス稼働率 | 99%未満 |

### 8.3 ロールバック計画

**トリガー条件**:
- エラー率が10%を超える
- 重大なセキュリティ問題の発見
- パフォーマンス著しく低下

**ロールバック手順**:
1. [手順1]
2. [手順2]
3. [手順3]
